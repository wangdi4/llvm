# UNSUPPORTED: !linux
# REQUIRES: default_linker_bfd

# Test for checking that LLD links GNU LTO objects when the system is using
# BFD as default linker. This is the same test case as support_gnu_lto_1.test,
# the only difference is that it will run only when BFD is set as the default
# linker (requires default_linker_bfd).

# Compile with g++ and LTO
# RUN: g++ -c -flto %S/Inputs/driver.cpp -o %t_driver.o
# RUN: g++ -c -flto %S/Inputs/foo.cpp -o %t_foo.o
# RUN: g++ -c -flto %S/Inputs/bar.cpp -o %t_bar.o
# RUN: g++ -c -flto %S/Inputs/baz.cpp -o %t_baz.o

# Link
# RUN: clang++ -fuse-ld=lld %t_driver.o %t_foo.o %t_bar.o %t_baz.o -o %t_gnu_lto_test_bfd > %t_out.txt 2>&1
# RUN: cat %t_out.txt | FileCheck -check-prefix=CHECKLINK %s -allow-empty

# Check that the files were linked correctly
CHECKLINK-NOT: error: undefined symbol: main
CHECKLINK: GNU LTO files found in the command line.

# Check that the executable runs correctly
# RUN: %t_gnu_lto_test_bfd | FileCheck -check-prefix=CHECKRUN1 %s
CHECKRUN1: FOO: 1
CHECKRUN1: BAR: 2
CHECKRUN1: BAZ: 3
