# This tests that lprofMergeValueProfData is not accessed from outside a module
RUN: mkdir -p %t.d
# INTEL_CUSTOMIZATION
# Temporarily remove "-Wl,--gc-sections" from compiler command lines because
# this is causing errors with the version of ld.gold in the binutils we use.
# When our binutils is upgraded to at least version 2.37, this option can
# be added back.
RUN: %clang_profgen -o %t.d/func.shared -fPIC -shared -fuse-ld=gold -mllvm --enable-value-profiling=true %S/../Inputs/instrprof-value-prof-visibility.c -fdata-sections -ffunction-sections -fuse-ld=gold
RUN: %clang_profgen -o %t.d/main -fuse-ld=gold -mllvm --enable-value-profiling=true  -DDLOPEN_FUNC_DIR=\"%t.d\" %S/../Inputs/instrprof-value-prof-visibility.c -fdata-sections -ffunction-sections -fuse-ld=gold
# end INTEL_CUSTOMIZATION
RUN: env LLVM_PROFILE_FILE=%t.profraw %run %t.d/main

