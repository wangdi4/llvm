//===-- X86InstrFoldTables.cpp - X86 Instruction Folding Tables -----------===//
// INTEL_CUSTOMIZATION
//
// INTEL CONFIDENTIAL
//
// Modifications, Copyright (C) 2021 Intel Corporation
//
// This software and the related documents are Intel copyrighted materials, and
// your use of them is governed by the express license under which they were
// provided to you ("License"). Unless the License provides otherwise, you may not
// use, modify, copy, publish, distribute, disclose or transmit this software or
// the related documents without Intel's prior written permission.
//
// This software and the related documents are provided as is, with no express
// or implied warranties, other than those that are expressly stated in the
// License.
//
// end INTEL_CUSTOMIZATION
//
// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
// See https://llvm.org/LICENSE.txt for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
//
//===----------------------------------------------------------------------===//
//
// This file contains the X86 memory folding tables.
//
//===----------------------------------------------------------------------===//

#include "X86InstrFoldTables.h"
#include "X86InstrInfo.h"
#include "llvm/ADT/STLExtras.h"
#include <atomic>
#include <vector>

using namespace llvm;

// These tables are sorted by their RegOp value allowing them to be binary
// searched at runtime without the need for additional storage. The enum values
// are currently emitted in X86GenInstrInfo.inc in alphabetical order. Which
// makes sorting these tables a simple matter of alphabetizing the table.
#include "X86GenFoldTables.inc"
static const X86MemoryFoldTableEntry BroadcastFoldTable2[] = {
  { X86::VADDPDZ128rr,   X86::VADDPDZ128rmb,   TB_BCAST_SD },
  { X86::VADDPDZ256rr,   X86::VADDPDZ256rmb,   TB_BCAST_SD },
  { X86::VADDPDZrr,      X86::VADDPDZrmb,      TB_BCAST_SD },
  { X86::VADDPSZ128rr,   X86::VADDPSZ128rmb,   TB_BCAST_SS },
  { X86::VADDPSZ256rr,   X86::VADDPSZ256rmb,   TB_BCAST_SS },
  { X86::VADDPSZrr,      X86::VADDPSZrmb,      TB_BCAST_SS },
  { X86::VANDNPDZ128rr,  X86::VANDNPDZ128rmb,  TB_BCAST_SD },
  { X86::VANDNPDZ256rr,  X86::VANDNPDZ256rmb,  TB_BCAST_SD },
  { X86::VANDNPDZrr,     X86::VANDNPDZrmb,     TB_BCAST_SD },
  { X86::VANDNPSZ128rr,  X86::VANDNPSZ128rmb,  TB_BCAST_SS },
  { X86::VANDNPSZ256rr,  X86::VANDNPSZ256rmb,  TB_BCAST_SS },
  { X86::VANDNPSZrr,     X86::VANDNPSZrmb,     TB_BCAST_SS },
  { X86::VANDPDZ128rr,   X86::VANDPDZ128rmb,   TB_BCAST_SD },
  { X86::VANDPDZ256rr,   X86::VANDPDZ256rmb,   TB_BCAST_SD },
  { X86::VANDPDZrr,      X86::VANDPDZrmb,      TB_BCAST_SD },
  { X86::VANDPSZ128rr,   X86::VANDPSZ128rmb,   TB_BCAST_SS },
  { X86::VANDPSZ256rr,   X86::VANDPSZ256rmb,   TB_BCAST_SS },
  { X86::VANDPSZrr,      X86::VANDPSZrmb,      TB_BCAST_SS },
  { X86::VCMPPDZ128rri,  X86::VCMPPDZ128rmbi,  TB_BCAST_SD },
  { X86::VCMPPDZ256rri,  X86::VCMPPDZ256rmbi,  TB_BCAST_SD },
  { X86::VCMPPDZrri,     X86::VCMPPDZrmbi,     TB_BCAST_SD },
  { X86::VCMPPSZ128rri,  X86::VCMPPSZ128rmbi,  TB_BCAST_SS },
  { X86::VCMPPSZ256rri,  X86::VCMPPSZ256rmbi,  TB_BCAST_SS },
  { X86::VCMPPSZrri,     X86::VCMPPSZrmbi,     TB_BCAST_SS },
  { X86::VDIVPDZ128rr,   X86::VDIVPDZ128rmb,   TB_BCAST_SD },
  { X86::VDIVPDZ256rr,   X86::VDIVPDZ256rmb,   TB_BCAST_SD },
  { X86::VDIVPDZrr,      X86::VDIVPDZrmb,      TB_BCAST_SD },
  { X86::VDIVPSZ128rr,   X86::VDIVPSZ128rmb,   TB_BCAST_SS },
  { X86::VDIVPSZ256rr,   X86::VDIVPSZ256rmb,   TB_BCAST_SS },
  { X86::VDIVPSZrr,      X86::VDIVPSZrmb,      TB_BCAST_SS },
  { X86::VMAXCPDZ128rr,  X86::VMAXCPDZ128rmb,  TB_BCAST_SD },
  { X86::VMAXCPDZ256rr,  X86::VMAXCPDZ256rmb,  TB_BCAST_SD },
  { X86::VMAXCPDZrr,     X86::VMAXCPDZrmb,     TB_BCAST_SD },
  { X86::VMAXCPSZ128rr,  X86::VMAXCPSZ128rmb,  TB_BCAST_SS },
  { X86::VMAXCPSZ256rr,  X86::VMAXCPSZ256rmb,  TB_BCAST_SS },
  { X86::VMAXCPSZrr,     X86::VMAXCPSZrmb,     TB_BCAST_SS },
  { X86::VMAXPDZ128rr,   X86::VMAXPDZ128rmb,   TB_BCAST_SD },
  { X86::VMAXPDZ256rr,   X86::VMAXPDZ256rmb,   TB_BCAST_SD },
  { X86::VMAXPDZrr,      X86::VMAXPDZrmb,      TB_BCAST_SD },
  { X86::VMAXPSZ128rr,   X86::VMAXPSZ128rmb,   TB_BCAST_SS },
  { X86::VMAXPSZ256rr,   X86::VMAXPSZ256rmb,   TB_BCAST_SS },
  { X86::VMAXPSZrr,      X86::VMAXPSZrmb,      TB_BCAST_SS },
  { X86::VMINCPDZ128rr,  X86::VMINCPDZ128rmb,  TB_BCAST_SD },
  { X86::VMINCPDZ256rr,  X86::VMINCPDZ256rmb,  TB_BCAST_SD },
  { X86::VMINCPDZrr,     X86::VMINCPDZrmb,     TB_BCAST_SD },
  { X86::VMINCPSZ128rr,  X86::VMINCPSZ128rmb,  TB_BCAST_SS },
  { X86::VMINCPSZ256rr,  X86::VMINCPSZ256rmb,  TB_BCAST_SS },
  { X86::VMINCPSZrr,     X86::VMINCPSZrmb,     TB_BCAST_SS },
  { X86::VMINPDZ128rr,   X86::VMINPDZ128rmb,   TB_BCAST_SD },
  { X86::VMINPDZ256rr,   X86::VMINPDZ256rmb,   TB_BCAST_SD },
  { X86::VMINPDZrr,      X86::VMINPDZrmb,      TB_BCAST_SD },
  { X86::VMINPSZ128rr,   X86::VMINPSZ128rmb,   TB_BCAST_SS },
  { X86::VMINPSZ256rr,   X86::VMINPSZ256rmb,   TB_BCAST_SS },
  { X86::VMINPSZrr,      X86::VMINPSZrmb,      TB_BCAST_SS },
#if INTEL_CUSTOMIZATION
  { X86::VMOVAPDZ256rrkz,   X86::VBROADCASTSDZ256rmkz,TB_BCAST_SD },
  { X86::VMOVAPDZrrkz,      X86::VBROADCASTSDZrmkz,   TB_BCAST_SD },
  { X86::VMOVAPSZ128rrkz,   X86::VBROADCASTSSZ128rmkz,TB_BCAST_SS },
  { X86::VMOVAPSZ256rrkz,   X86::VBROADCASTSSZ256rmkz,TB_BCAST_SS },
  { X86::VMOVAPSZrrkz,      X86::VBROADCASTSSZrmkz,   TB_BCAST_SS },
  { X86::VMOVDQA32Z128rrkz, X86::VPBROADCASTDZ128rmkz,TB_BCAST_D },
  { X86::VMOVDQA32Z256rrkz, X86::VPBROADCASTDZ256rmkz,TB_BCAST_D },
  { X86::VMOVDQA32Zrrkz,    X86::VPBROADCASTDZrmkz,   TB_BCAST_D },
  { X86::VMOVDQA64Z128rrkz, X86::VPBROADCASTQZ128rmkz,TB_BCAST_Q },
  { X86::VMOVDQA64Z256rrkz, X86::VPBROADCASTQZ256rmkz,TB_BCAST_Q },
  { X86::VMOVDQA64Zrrkz,    X86::VPBROADCASTQZrmkz,   TB_BCAST_Q },
#endif // INTEL_CUSTOMIZATION
  { X86::VMULPDZ128rr,   X86::VMULPDZ128rmb,   TB_BCAST_SD },
  { X86::VMULPDZ256rr,   X86::VMULPDZ256rmb,   TB_BCAST_SD },
  { X86::VMULPDZrr,      X86::VMULPDZrmb,      TB_BCAST_SD },
  { X86::VMULPSZ128rr,   X86::VMULPSZ128rmb,   TB_BCAST_SS },
  { X86::VMULPSZ256rr,   X86::VMULPSZ256rmb,   TB_BCAST_SS },
  { X86::VMULPSZrr,      X86::VMULPSZrmb,      TB_BCAST_SS },
  { X86::VORPDZ128rr,    X86::VORPDZ128rmb,    TB_BCAST_SD },
  { X86::VORPDZ256rr,    X86::VORPDZ256rmb,    TB_BCAST_SD },
  { X86::VORPDZrr,       X86::VORPDZrmb,       TB_BCAST_SD },
  { X86::VORPSZ128rr,    X86::VORPSZ128rmb,    TB_BCAST_SS },
  { X86::VORPSZ256rr,    X86::VORPSZ256rmb,    TB_BCAST_SS },
  { X86::VORPSZrr,       X86::VORPSZrmb,       TB_BCAST_SS },
  { X86::VPADDDZ128rr,   X86::VPADDDZ128rmb,   TB_BCAST_D },
  { X86::VPADDDZ256rr,   X86::VPADDDZ256rmb,   TB_BCAST_D },
  { X86::VPADDDZrr,      X86::VPADDDZrmb,      TB_BCAST_D },
  { X86::VPADDQZ128rr,   X86::VPADDQZ128rmb,   TB_BCAST_Q },
  { X86::VPADDQZ256rr,   X86::VPADDQZ256rmb,   TB_BCAST_Q },
  { X86::VPADDQZrr,      X86::VPADDQZrmb,      TB_BCAST_Q },
  { X86::VPANDDZ128rr,   X86::VPANDDZ128rmb,   TB_BCAST_D },
  { X86::VPANDDZ256rr,   X86::VPANDDZ256rmb,   TB_BCAST_D },
  { X86::VPANDDZrr,      X86::VPANDDZrmb,      TB_BCAST_D },
  { X86::VPANDNDZ128rr,  X86::VPANDNDZ128rmb,  TB_BCAST_D },
  { X86::VPANDNDZ256rr,  X86::VPANDNDZ256rmb,  TB_BCAST_D },
  { X86::VPANDNDZrr,     X86::VPANDNDZrmb,     TB_BCAST_D },
  { X86::VPANDNQZ128rr,  X86::VPANDNQZ128rmb,  TB_BCAST_Q },
  { X86::VPANDNQZ256rr,  X86::VPANDNQZ256rmb,  TB_BCAST_Q },
  { X86::VPANDNQZrr,     X86::VPANDNQZrmb,     TB_BCAST_Q },
  { X86::VPANDQZ128rr,   X86::VPANDQZ128rmb,   TB_BCAST_Q },
  { X86::VPANDQZ256rr,   X86::VPANDQZ256rmb,   TB_BCAST_Q },
  { X86::VPANDQZrr,      X86::VPANDQZrmb,      TB_BCAST_Q },
  { X86::VPCMPDZ128rri,  X86::VPCMPDZ128rmib,  TB_BCAST_D },
  { X86::VPCMPDZ256rri,  X86::VPCMPDZ256rmib,  TB_BCAST_D },
  { X86::VPCMPDZrri,     X86::VPCMPDZrmib,     TB_BCAST_D },
  { X86::VPCMPEQDZ128rr, X86::VPCMPEQDZ128rmb, TB_BCAST_D },
  { X86::VPCMPEQDZ256rr, X86::VPCMPEQDZ256rmb, TB_BCAST_D },
  { X86::VPCMPEQDZrr,    X86::VPCMPEQDZrmb,    TB_BCAST_D },
  { X86::VPCMPEQQZ128rr, X86::VPCMPEQQZ128rmb, TB_BCAST_Q },
  { X86::VPCMPEQQZ256rr, X86::VPCMPEQQZ256rmb, TB_BCAST_Q },
  { X86::VPCMPEQQZrr,    X86::VPCMPEQQZrmb,    TB_BCAST_Q },
  { X86::VPCMPGTDZ128rr, X86::VPCMPGTDZ128rmb, TB_BCAST_D },
  { X86::VPCMPGTDZ256rr, X86::VPCMPGTDZ256rmb, TB_BCAST_D },
  { X86::VPCMPGTDZrr,    X86::VPCMPGTDZrmb,    TB_BCAST_D },
  { X86::VPCMPGTQZ128rr, X86::VPCMPGTQZ128rmb, TB_BCAST_Q },
  { X86::VPCMPGTQZ256rr, X86::VPCMPGTQZ256rmb, TB_BCAST_Q },
  { X86::VPCMPGTQZrr,    X86::VPCMPGTQZrmb,    TB_BCAST_Q },
  { X86::VPCMPQZ128rri,  X86::VPCMPQZ128rmib,  TB_BCAST_Q },
  { X86::VPCMPQZ256rri,  X86::VPCMPQZ256rmib,  TB_BCAST_Q },
  { X86::VPCMPQZrri,     X86::VPCMPQZrmib,     TB_BCAST_Q },
  { X86::VPCMPUDZ128rri, X86::VPCMPUDZ128rmib, TB_BCAST_D },
  { X86::VPCMPUDZ256rri, X86::VPCMPUDZ256rmib, TB_BCAST_D },
  { X86::VPCMPUDZrri,    X86::VPCMPUDZrmib,    TB_BCAST_D },
  { X86::VPCMPUQZ128rri, X86::VPCMPUQZ128rmib, TB_BCAST_Q },
  { X86::VPCMPUQZ256rri, X86::VPCMPUQZ256rmib, TB_BCAST_Q },
  { X86::VPCMPUQZrri,    X86::VPCMPUQZrmib,    TB_BCAST_Q },
  { X86::VPMAXSDZ128rr,  X86::VPMAXSDZ128rmb,  TB_BCAST_D },
  { X86::VPMAXSDZ256rr,  X86::VPMAXSDZ256rmb,  TB_BCAST_D },
  { X86::VPMAXSDZrr,     X86::VPMAXSDZrmb,     TB_BCAST_D },
  { X86::VPMAXSQZ128rr,  X86::VPMAXSQZ128rmb,  TB_BCAST_Q },
  { X86::VPMAXSQZ256rr,  X86::VPMAXSQZ256rmb,  TB_BCAST_Q },
  { X86::VPMAXSQZrr,     X86::VPMAXSQZrmb,     TB_BCAST_Q },
  { X86::VPMAXUDZ128rr,  X86::VPMAXUDZ128rmb,  TB_BCAST_D },
  { X86::VPMAXUDZ256rr,  X86::VPMAXUDZ256rmb,  TB_BCAST_D },
  { X86::VPMAXUDZrr,     X86::VPMAXUDZrmb,     TB_BCAST_D },
  { X86::VPMAXUQZ128rr,  X86::VPMAXUQZ128rmb,  TB_BCAST_Q },
  { X86::VPMAXUQZ256rr,  X86::VPMAXUQZ256rmb,  TB_BCAST_Q },
  { X86::VPMAXUQZrr,     X86::VPMAXUQZrmb,     TB_BCAST_Q },
  { X86::VPMINSDZ128rr,  X86::VPMINSDZ128rmb,  TB_BCAST_D },
  { X86::VPMINSDZ256rr,  X86::VPMINSDZ256rmb,  TB_BCAST_D },
  { X86::VPMINSDZrr,     X86::VPMINSDZrmb,     TB_BCAST_D },
  { X86::VPMINSQZ128rr,  X86::VPMINSQZ128rmb,  TB_BCAST_Q },
  { X86::VPMINSQZ256rr,  X86::VPMINSQZ256rmb,  TB_BCAST_Q },
  { X86::VPMINSQZrr,     X86::VPMINSQZrmb,     TB_BCAST_Q },
  { X86::VPMINUDZ128rr,  X86::VPMINUDZ128rmb,  TB_BCAST_D },
  { X86::VPMINUDZ256rr,  X86::VPMINUDZ256rmb,  TB_BCAST_D },
  { X86::VPMINUDZrr,     X86::VPMINUDZrmb,     TB_BCAST_D },
  { X86::VPMINUQZ128rr,  X86::VPMINUQZ128rmb,  TB_BCAST_Q },
  { X86::VPMINUQZ256rr,  X86::VPMINUQZ256rmb,  TB_BCAST_Q },
  { X86::VPMINUQZrr,     X86::VPMINUQZrmb,     TB_BCAST_Q },
  { X86::VPMULLDZ128rr,  X86::VPMULLDZ128rmb,  TB_BCAST_D },
  { X86::VPMULLDZ256rr,  X86::VPMULLDZ256rmb,  TB_BCAST_D },
  { X86::VPMULLDZrr,     X86::VPMULLDZrmb,     TB_BCAST_D },
  { X86::VPMULLQZ128rr,  X86::VPMULLQZ128rmb,  TB_BCAST_Q },
  { X86::VPMULLQZ256rr,  X86::VPMULLQZ256rmb,  TB_BCAST_Q },
  { X86::VPMULLQZrr,     X86::VPMULLQZrmb,     TB_BCAST_Q },
  { X86::VPORDZ128rr,    X86::VPORDZ128rmb,    TB_BCAST_D },
  { X86::VPORDZ256rr,    X86::VPORDZ256rmb,    TB_BCAST_D },
  { X86::VPORDZrr,       X86::VPORDZrmb,       TB_BCAST_D },
  { X86::VPORQZ128rr,    X86::VPORQZ128rmb,    TB_BCAST_Q },
  { X86::VPORQZ256rr,    X86::VPORQZ256rmb,    TB_BCAST_Q },
  { X86::VPORQZrr,       X86::VPORQZrmb,       TB_BCAST_Q },
#if INTEL_CUSTOMIZATION
  { X86::VPSUBDZ128rr,   X86::VPSUBDZ128rmb,   TB_BCAST_D },
  { X86::VPSUBDZ256rr,   X86::VPSUBDZ256rmb,   TB_BCAST_D },
  { X86::VPSUBDZrr,      X86::VPSUBDZrmb,      TB_BCAST_D },
  { X86::VPSUBQZ128rr,   X86::VPSUBQZ128rmb,   TB_BCAST_Q },
  { X86::VPSUBQZ256rr,   X86::VPSUBQZ256rmb,   TB_BCAST_Q },
  { X86::VPSUBQZrr,      X86::VPSUBQZrmb,      TB_BCAST_Q },
#endif // INTEL_CUSTOMIZATION
  { X86::VPTESTMDZ128rr, X86::VPTESTMDZ128rmb, TB_BCAST_D },
  { X86::VPTESTMDZ256rr, X86::VPTESTMDZ256rmb, TB_BCAST_D },
  { X86::VPTESTMDZrr,    X86::VPTESTMDZrmb,    TB_BCAST_D },
  { X86::VPTESTMQZ128rr, X86::VPTESTMQZ128rmb, TB_BCAST_Q },
  { X86::VPTESTMQZ256rr, X86::VPTESTMQZ256rmb, TB_BCAST_Q },
  { X86::VPTESTMQZrr,    X86::VPTESTMQZrmb,    TB_BCAST_Q },
  { X86::VPTESTNMDZ128rr,X86::VPTESTNMDZ128rmb,TB_BCAST_D },
  { X86::VPTESTNMDZ256rr,X86::VPTESTNMDZ256rmb,TB_BCAST_D },
  { X86::VPTESTNMDZrr,   X86::VPTESTNMDZrmb,   TB_BCAST_D },
  { X86::VPTESTNMQZ128rr,X86::VPTESTNMQZ128rmb,TB_BCAST_Q },
  { X86::VPTESTNMQZ256rr,X86::VPTESTNMQZ256rmb,TB_BCAST_Q },
  { X86::VPTESTNMQZrr,   X86::VPTESTNMQZrmb,   TB_BCAST_Q },
  { X86::VPXORDZ128rr,   X86::VPXORDZ128rmb,   TB_BCAST_D },
  { X86::VPXORDZ256rr,   X86::VPXORDZ256rmb,   TB_BCAST_D },
  { X86::VPXORDZrr,      X86::VPXORDZrmb,      TB_BCAST_D },
  { X86::VPXORQZ128rr,   X86::VPXORQZ128rmb,   TB_BCAST_Q },
  { X86::VPXORQZ256rr,   X86::VPXORQZ256rmb,   TB_BCAST_Q },
  { X86::VPXORQZrr,      X86::VPXORQZrmb,      TB_BCAST_Q },
  { X86::VSUBPDZ128rr,   X86::VSUBPDZ128rmb,   TB_BCAST_SD },
  { X86::VSUBPDZ256rr,   X86::VSUBPDZ256rmb,   TB_BCAST_SD },
  { X86::VSUBPDZrr,      X86::VSUBPDZrmb,      TB_BCAST_SD },
  { X86::VSUBPSZ128rr,   X86::VSUBPSZ128rmb,   TB_BCAST_SS },
  { X86::VSUBPSZ256rr,   X86::VSUBPSZ256rmb,   TB_BCAST_SS },
  { X86::VSUBPSZrr,      X86::VSUBPSZrmb,      TB_BCAST_SS },
  { X86::VXORPDZ128rr,   X86::VXORPDZ128rmb,   TB_BCAST_SD },
  { X86::VXORPDZ256rr,   X86::VXORPDZ256rmb,   TB_BCAST_SD },
  { X86::VXORPDZrr,      X86::VXORPDZrmb,      TB_BCAST_SD },
  { X86::VXORPSZ128rr,   X86::VXORPSZ128rmb,   TB_BCAST_SS },
  { X86::VXORPSZ256rr,   X86::VXORPSZ256rmb,   TB_BCAST_SS },
  { X86::VXORPSZrr,      X86::VXORPSZrmb,      TB_BCAST_SS },
};

static const X86MemoryFoldTableEntry BroadcastFoldTable3[] = {
#if INTEL_CUSTOMIZATION
  { X86::VADDPDZ128rrkz,       X86::VADDPDZ128rmbkz,      TB_BCAST_SD },
  { X86::VADDPDZ256rrkz,       X86::VADDPDZ256rmbkz,      TB_BCAST_SD },
  { X86::VADDPDZrrkz,          X86::VADDPDZrmbkz,         TB_BCAST_SD },
  { X86::VADDPSZ128rrkz,       X86::VADDPSZ128rmbkz,      TB_BCAST_SS },
  { X86::VADDPSZ256rrkz,       X86::VADDPSZ256rmbkz,      TB_BCAST_SS },
  { X86::VADDPSZrrkz,          X86::VADDPSZrmbkz,         TB_BCAST_SS },
  { X86::VCMPPDZ128rrik,       X86::VCMPPDZ128rmbik,      TB_BCAST_SD },
  { X86::VCMPPDZ256rrik,       X86::VCMPPDZ256rmbik,      TB_BCAST_SD },
  { X86::VCMPPDZrrik,          X86::VCMPPDZrmbik,         TB_BCAST_SD },
  { X86::VCMPPSZ128rrik,       X86::VCMPPSZ128rmbik,      TB_BCAST_SS },
  { X86::VCMPPSZ256rrik,       X86::VCMPPSZ256rmbik,      TB_BCAST_SS },
  { X86::VCMPPSZrrik,          X86::VCMPPSZrmbik,         TB_BCAST_SS },
  { X86::VDIVPDZ128rrkz,       X86::VDIVPDZ128rmbkz,      TB_BCAST_SD },
  { X86::VDIVPDZ256rrkz,       X86::VDIVPDZ256rmbkz,      TB_BCAST_SD },
  { X86::VDIVPDZrrkz,          X86::VDIVPDZrmbkz,         TB_BCAST_SD },
  { X86::VDIVPSZ128rrkz,       X86::VDIVPSZ128rmbkz,      TB_BCAST_SS },
  { X86::VDIVPSZ256rrkz,       X86::VDIVPSZ256rmbkz,      TB_BCAST_SS },
  { X86::VDIVPSZrrkz,          X86::VDIVPSZrmbkz,         TB_BCAST_SS },
#endif // INTEL_CUSTOMIZATION
  { X86::VFMADD132PDZ128r,     X86::VFMADD132PDZ128mb,    TB_BCAST_SD },
  { X86::VFMADD132PDZ256r,     X86::VFMADD132PDZ256mb,    TB_BCAST_SD },
  { X86::VFMADD132PDZr,        X86::VFMADD132PDZmb,       TB_BCAST_SD },
  { X86::VFMADD132PSZ128r,     X86::VFMADD132PSZ128mb,    TB_BCAST_SS },
  { X86::VFMADD132PSZ256r,     X86::VFMADD132PSZ256mb,    TB_BCAST_SS },
  { X86::VFMADD132PSZr,        X86::VFMADD132PSZmb,       TB_BCAST_SS },
  { X86::VFMADD213PDZ128r,     X86::VFMADD213PDZ128mb,    TB_BCAST_SD },
  { X86::VFMADD213PDZ256r,     X86::VFMADD213PDZ256mb,    TB_BCAST_SD },
  { X86::VFMADD213PDZr,        X86::VFMADD213PDZmb,       TB_BCAST_SD },
  { X86::VFMADD213PSZ128r,     X86::VFMADD213PSZ128mb,    TB_BCAST_SS },
  { X86::VFMADD213PSZ256r,     X86::VFMADD213PSZ256mb,    TB_BCAST_SS },
  { X86::VFMADD213PSZr,        X86::VFMADD213PSZmb,       TB_BCAST_SS },
  { X86::VFMADD231PDZ128r,     X86::VFMADD231PDZ128mb,    TB_BCAST_SD },
  { X86::VFMADD231PDZ256r,     X86::VFMADD231PDZ256mb,    TB_BCAST_SD },
  { X86::VFMADD231PDZr,        X86::VFMADD231PDZmb,       TB_BCAST_SD },
  { X86::VFMADD231PSZ128r,     X86::VFMADD231PSZ128mb,    TB_BCAST_SS },
  { X86::VFMADD231PSZ256r,     X86::VFMADD231PSZ256mb,    TB_BCAST_SS },
  { X86::VFMADD231PSZr,        X86::VFMADD231PSZmb,       TB_BCAST_SS },
  { X86::VFMADDSUB132PDZ128r,  X86::VFMADDSUB132PDZ128mb, TB_BCAST_SD },
  { X86::VFMADDSUB132PDZ256r,  X86::VFMADDSUB132PDZ256mb, TB_BCAST_SD },
  { X86::VFMADDSUB132PDZr,     X86::VFMADDSUB132PDZmb,    TB_BCAST_SD },
  { X86::VFMADDSUB132PSZ128r,  X86::VFMADDSUB132PSZ128mb, TB_BCAST_SS },
  { X86::VFMADDSUB132PSZ256r,  X86::VFMADDSUB132PSZ256mb, TB_BCAST_SS },
  { X86::VFMADDSUB132PSZr,     X86::VFMADDSUB132PSZmb,    TB_BCAST_SS },
  { X86::VFMADDSUB213PDZ128r,  X86::VFMADDSUB213PDZ128mb, TB_BCAST_SD },
  { X86::VFMADDSUB213PDZ256r,  X86::VFMADDSUB213PDZ256mb, TB_BCAST_SD },
  { X86::VFMADDSUB213PDZr,     X86::VFMADDSUB213PDZmb,    TB_BCAST_SD },
  { X86::VFMADDSUB213PSZ128r,  X86::VFMADDSUB213PSZ128mb, TB_BCAST_SS },
  { X86::VFMADDSUB213PSZ256r,  X86::VFMADDSUB213PSZ256mb, TB_BCAST_SS },
  { X86::VFMADDSUB213PSZr,     X86::VFMADDSUB213PSZmb,    TB_BCAST_SS },
  { X86::VFMADDSUB231PDZ128r,  X86::VFMADDSUB231PDZ128mb, TB_BCAST_SD },
  { X86::VFMADDSUB231PDZ256r,  X86::VFMADDSUB231PDZ256mb, TB_BCAST_SD },
  { X86::VFMADDSUB231PDZr,     X86::VFMADDSUB231PDZmb,    TB_BCAST_SD },
  { X86::VFMADDSUB231PSZ128r,  X86::VFMADDSUB231PSZ128mb, TB_BCAST_SS },
  { X86::VFMADDSUB231PSZ256r,  X86::VFMADDSUB231PSZ256mb, TB_BCAST_SS },
  { X86::VFMADDSUB231PSZr,     X86::VFMADDSUB231PSZmb,    TB_BCAST_SS },
  { X86::VFMSUB132PDZ128r,     X86::VFMSUB132PDZ128mb,    TB_BCAST_SD },
  { X86::VFMSUB132PDZ256r,     X86::VFMSUB132PDZ256mb,    TB_BCAST_SD },
  { X86::VFMSUB132PDZr,        X86::VFMSUB132PDZmb,       TB_BCAST_SD },
  { X86::VFMSUB132PSZ128r,     X86::VFMSUB132PSZ128mb,    TB_BCAST_SS },
  { X86::VFMSUB132PSZ256r,     X86::VFMSUB132PSZ256mb,    TB_BCAST_SS },
  { X86::VFMSUB132PSZr,        X86::VFMSUB132PSZmb,       TB_BCAST_SS },
  { X86::VFMSUB213PDZ128r,     X86::VFMSUB213PDZ128mb,    TB_BCAST_SD },
  { X86::VFMSUB213PDZ256r,     X86::VFMSUB213PDZ256mb,    TB_BCAST_SD },
  { X86::VFMSUB213PDZr,        X86::VFMSUB213PDZmb,       TB_BCAST_SD },
  { X86::VFMSUB213PSZ128r,     X86::VFMSUB213PSZ128mb,    TB_BCAST_SS },
  { X86::VFMSUB213PSZ256r,     X86::VFMSUB213PSZ256mb,    TB_BCAST_SS },
  { X86::VFMSUB213PSZr,        X86::VFMSUB213PSZmb,       TB_BCAST_SS },
  { X86::VFMSUB231PDZ128r,     X86::VFMSUB231PDZ128mb,    TB_BCAST_SD },
  { X86::VFMSUB231PDZ256r,     X86::VFMSUB231PDZ256mb,    TB_BCAST_SD },
  { X86::VFMSUB231PDZr,        X86::VFMSUB231PDZmb,       TB_BCAST_SD },
  { X86::VFMSUB231PSZ128r,     X86::VFMSUB231PSZ128mb,    TB_BCAST_SS },
  { X86::VFMSUB231PSZ256r,     X86::VFMSUB231PSZ256mb,    TB_BCAST_SS },
  { X86::VFMSUB231PSZr,        X86::VFMSUB231PSZmb,       TB_BCAST_SS },
  { X86::VFMSUBADD132PDZ128r,  X86::VFMSUBADD132PDZ128mb, TB_BCAST_SD },
  { X86::VFMSUBADD132PDZ256r,  X86::VFMSUBADD132PDZ256mb, TB_BCAST_SD },
  { X86::VFMSUBADD132PDZr,     X86::VFMSUBADD132PDZmb,    TB_BCAST_SD },
  { X86::VFMSUBADD132PSZ128r,  X86::VFMSUBADD132PSZ128mb, TB_BCAST_SS },
  { X86::VFMSUBADD132PSZ256r,  X86::VFMSUBADD132PSZ256mb, TB_BCAST_SS },
  { X86::VFMSUBADD132PSZr,     X86::VFMSUBADD132PSZmb,    TB_BCAST_SS },
  { X86::VFMSUBADD213PDZ128r,  X86::VFMSUBADD213PDZ128mb, TB_BCAST_SD },
  { X86::VFMSUBADD213PDZ256r,  X86::VFMSUBADD213PDZ256mb, TB_BCAST_SD },
  { X86::VFMSUBADD213PDZr,     X86::VFMSUBADD213PDZmb,    TB_BCAST_SD },
  { X86::VFMSUBADD213PSZ128r,  X86::VFMSUBADD213PSZ128mb, TB_BCAST_SS },
  { X86::VFMSUBADD213PSZ256r,  X86::VFMSUBADD213PSZ256mb, TB_BCAST_SS },
  { X86::VFMSUBADD213PSZr,     X86::VFMSUBADD213PSZmb,    TB_BCAST_SS },
  { X86::VFMSUBADD231PDZ128r,  X86::VFMSUBADD231PDZ128mb, TB_BCAST_SD },
  { X86::VFMSUBADD231PDZ256r,  X86::VFMSUBADD231PDZ256mb, TB_BCAST_SD },
  { X86::VFMSUBADD231PDZr,     X86::VFMSUBADD231PDZmb,    TB_BCAST_SD },
  { X86::VFMSUBADD231PSZ128r,  X86::VFMSUBADD231PSZ128mb, TB_BCAST_SS },
  { X86::VFMSUBADD231PSZ256r,  X86::VFMSUBADD231PSZ256mb, TB_BCAST_SS },
  { X86::VFMSUBADD231PSZr,     X86::VFMSUBADD231PSZmb,    TB_BCAST_SS },
  { X86::VFNMADD132PDZ128r,    X86::VFNMADD132PDZ128mb,   TB_BCAST_SD },
  { X86::VFNMADD132PDZ256r,    X86::VFNMADD132PDZ256mb,   TB_BCAST_SD },
  { X86::VFNMADD132PDZr,       X86::VFNMADD132PDZmb,      TB_BCAST_SD },
  { X86::VFNMADD132PSZ128r,    X86::VFNMADD132PSZ128mb,   TB_BCAST_SS },
  { X86::VFNMADD132PSZ256r,    X86::VFNMADD132PSZ256mb,   TB_BCAST_SS },
  { X86::VFNMADD132PSZr,       X86::VFNMADD132PSZmb,      TB_BCAST_SS },
  { X86::VFNMADD213PDZ128r,    X86::VFNMADD213PDZ128mb,   TB_BCAST_SD },
  { X86::VFNMADD213PDZ256r,    X86::VFNMADD213PDZ256mb,   TB_BCAST_SD },
  { X86::VFNMADD213PDZr,       X86::VFNMADD213PDZmb,      TB_BCAST_SD },
  { X86::VFNMADD213PSZ128r,    X86::VFNMADD213PSZ128mb,   TB_BCAST_SS },
  { X86::VFNMADD213PSZ256r,    X86::VFNMADD213PSZ256mb,   TB_BCAST_SS },
  { X86::VFNMADD213PSZr,       X86::VFNMADD213PSZmb,      TB_BCAST_SS },
  { X86::VFNMADD231PDZ128r,    X86::VFNMADD231PDZ128mb,   TB_BCAST_SD },
  { X86::VFNMADD231PDZ256r,    X86::VFNMADD231PDZ256mb,   TB_BCAST_SD },
  { X86::VFNMADD231PDZr,       X86::VFNMADD231PDZmb,      TB_BCAST_SD },
  { X86::VFNMADD231PSZ128r,    X86::VFNMADD231PSZ128mb,   TB_BCAST_SS },
  { X86::VFNMADD231PSZ256r,    X86::VFNMADD231PSZ256mb,   TB_BCAST_SS },
  { X86::VFNMADD231PSZr,       X86::VFNMADD231PSZmb,      TB_BCAST_SS },
  { X86::VFNMSUB132PDZ128r,    X86::VFNMSUB132PDZ128mb,   TB_BCAST_SD },
  { X86::VFNMSUB132PDZ256r,    X86::VFNMSUB132PDZ256mb,   TB_BCAST_SD },
  { X86::VFNMSUB132PDZr,       X86::VFNMSUB132PDZmb,      TB_BCAST_SD },
  { X86::VFNMSUB132PSZ128r,    X86::VFNMSUB132PSZ128mb,   TB_BCAST_SS },
  { X86::VFNMSUB132PSZ256r,    X86::VFNMSUB132PSZ256mb,   TB_BCAST_SS },
  { X86::VFNMSUB132PSZr,       X86::VFNMSUB132PSZmb,      TB_BCAST_SS },
  { X86::VFNMSUB213PDZ128r,    X86::VFNMSUB213PDZ128mb,   TB_BCAST_SD },
  { X86::VFNMSUB213PDZ256r,    X86::VFNMSUB213PDZ256mb,   TB_BCAST_SD },
  { X86::VFNMSUB213PDZr,       X86::VFNMSUB213PDZmb,      TB_BCAST_SD },
  { X86::VFNMSUB213PSZ128r,    X86::VFNMSUB213PSZ128mb,   TB_BCAST_SS },
  { X86::VFNMSUB213PSZ256r,    X86::VFNMSUB213PSZ256mb,   TB_BCAST_SS },
  { X86::VFNMSUB213PSZr,       X86::VFNMSUB213PSZmb,      TB_BCAST_SS },
  { X86::VFNMSUB231PDZ128r,    X86::VFNMSUB231PDZ128mb,   TB_BCAST_SD },
  { X86::VFNMSUB231PDZ256r,    X86::VFNMSUB231PDZ256mb,   TB_BCAST_SD },
  { X86::VFNMSUB231PDZr,       X86::VFNMSUB231PDZmb,      TB_BCAST_SD },
  { X86::VFNMSUB231PSZ128r,    X86::VFNMSUB231PSZ128mb,   TB_BCAST_SS },
  { X86::VFNMSUB231PSZ256r,    X86::VFNMSUB231PSZ256mb,   TB_BCAST_SS },
  { X86::VFNMSUB231PSZr,       X86::VFNMSUB231PSZmb,      TB_BCAST_SS },
#if INTEL_CUSTOMIZATION
  { X86::VMAXCPDZ128rrkz,      X86::VMAXCPDZ128rmbkz,     TB_BCAST_SD },
  { X86::VMAXCPDZ256rrkz,      X86::VMAXCPDZ256rmbkz,     TB_BCAST_SD },
  { X86::VMAXCPDZrrkz,         X86::VMAXCPDZrmbkz,        TB_BCAST_SD },
  { X86::VMAXCPSZ128rrkz,      X86::VMAXCPSZ128rmbkz,     TB_BCAST_SS },
  { X86::VMAXCPSZ256rrkz,      X86::VMAXCPSZ256rmbkz,     TB_BCAST_SS },
  { X86::VMAXCPSZrrkz,         X86::VMAXCPSZrmbkz,        TB_BCAST_SS },
  { X86::VMAXPDZ128rrkz,       X86::VMAXPDZ128rmbkz,      TB_BCAST_SD },
  { X86::VMAXPDZ256rrkz,       X86::VMAXPDZ256rmbkz,      TB_BCAST_SD },
  { X86::VMAXPDZrrkz,          X86::VMAXPDZrmbkz,         TB_BCAST_SD },
  { X86::VMAXPSZ128rrkz,       X86::VMAXPSZ128rmbkz,      TB_BCAST_SS },
  { X86::VMAXPSZ256rrkz,       X86::VMAXPSZ256rmbkz,      TB_BCAST_SS },
  { X86::VMAXPSZrrkz,          X86::VMAXPSZrmbkz,         TB_BCAST_SS },
  { X86::VMINCPDZ128rrkz,      X86::VMINCPDZ128rmbkz,     TB_BCAST_SD },
  { X86::VMINCPDZ256rrkz,      X86::VMINCPDZ256rmbkz,     TB_BCAST_SD },
  { X86::VMINCPDZrrkz,         X86::VMINCPDZrmbkz,        TB_BCAST_SD },
  { X86::VMINCPSZ128rrkz,      X86::VMINCPSZ128rmbkz,     TB_BCAST_SS },
  { X86::VMINCPSZ256rrkz,      X86::VMINCPSZ256rmbkz,     TB_BCAST_SS },
  { X86::VMINCPSZrrkz,         X86::VMINCPSZrmbkz,        TB_BCAST_SS },
  { X86::VMINPDZ128rrkz,       X86::VMINPDZ128rmbkz,      TB_BCAST_SD },
  { X86::VMINPDZ256rrkz,       X86::VMINPDZ256rmbkz,      TB_BCAST_SD },
  { X86::VMINPDZrrkz,          X86::VMINPDZrmbkz,         TB_BCAST_SD },
  { X86::VMINPSZ128rrkz,       X86::VMINPSZ128rmbkz,      TB_BCAST_SS },
  { X86::VMINPSZ256rrkz,       X86::VMINPSZ256rmbkz,      TB_BCAST_SS },
  { X86::VMINPSZrrkz,          X86::VMINPSZrmbkz,         TB_BCAST_SS },
  { X86::VMOVAPDZ256rrk,       X86::VBROADCASTSDZ256rmk,  TB_BCAST_SD },
  { X86::VMOVAPDZrrk,          X86::VBROADCASTSDZrmk,     TB_BCAST_SD },
  { X86::VMOVAPSZ128rrk,       X86::VBROADCASTSSZ128rmk,  TB_BCAST_SS },
  { X86::VMOVAPSZ256rrk,       X86::VBROADCASTSSZ256rmk,  TB_BCAST_SS },
  { X86::VMOVAPSZrrk,          X86::VBROADCASTSSZrmk,     TB_BCAST_SS },
  { X86::VMOVDQA32Z128rrk,     X86::VPBROADCASTDZ128rmk,  TB_BCAST_D },
  { X86::VMOVDQA32Z256rrk,     X86::VPBROADCASTDZ256rmk,  TB_BCAST_D },
  { X86::VMOVDQA32Zrrk,        X86::VPBROADCASTDZrmk,     TB_BCAST_D },
  { X86::VMOVDQA64Z128rrk,     X86::VPBROADCASTQZ128rmk,  TB_BCAST_Q },
  { X86::VMOVDQA64Z256rrk,     X86::VPBROADCASTQZ256rmk,  TB_BCAST_Q },
  { X86::VMOVDQA64Zrrk,        X86::VPBROADCASTQZrmk,     TB_BCAST_Q },
  { X86::VMULPDZ128rrkz,       X86::VMULPDZ128rmbkz,      TB_BCAST_SD },
  { X86::VMULPDZ256rrkz,       X86::VMULPDZ256rmbkz,      TB_BCAST_SD },
  { X86::VMULPDZrrkz,          X86::VMULPDZrmbkz,         TB_BCAST_SD },
  { X86::VMULPSZ128rrkz,       X86::VMULPSZ128rmbkz,      TB_BCAST_SS },
  { X86::VMULPSZ256rrkz,       X86::VMULPSZ256rmbkz,      TB_BCAST_SS },
  { X86::VMULPSZrrkz,          X86::VMULPSZrmbkz,         TB_BCAST_SS },
  { X86::VPADDDZ128rrkz,       X86::VPADDDZ128rmbkz,      TB_BCAST_D },
  { X86::VPADDDZ256rrkz,       X86::VPADDDZ256rmbkz,      TB_BCAST_D },
  { X86::VPADDDZrrkz,          X86::VPADDDZrmbkz,         TB_BCAST_D },
  { X86::VPADDQZ128rrkz,       X86::VPADDQZ128rmbkz,      TB_BCAST_Q },
  { X86::VPADDQZ256rrkz,       X86::VPADDQZ256rmbkz,      TB_BCAST_Q },
  { X86::VPADDQZrrkz,          X86::VPADDQZrmbkz,         TB_BCAST_Q },
  { X86::VPANDDZ128rrkz,       X86::VPANDDZ128rmbkz,      TB_BCAST_D },
  { X86::VPANDDZ256rrkz,       X86::VPANDDZ256rmbkz,      TB_BCAST_D },
  { X86::VPANDDZrrkz,          X86::VPANDDZrmbkz,         TB_BCAST_D },
  { X86::VPANDNDZ128rrkz,      X86::VPANDNDZ128rmbkz,     TB_BCAST_D },
  { X86::VPANDNDZ256rrkz,      X86::VPANDNDZ256rmbkz,     TB_BCAST_D },
  { X86::VPANDNDZrrkz,         X86::VPANDNDZrmbkz,        TB_BCAST_D },
  { X86::VPANDNQZ128rrkz,      X86::VPANDNQZ128rmbkz,     TB_BCAST_Q },
  { X86::VPANDNQZ256rrkz,      X86::VPANDNQZ256rmbkz,     TB_BCAST_Q },
  { X86::VPANDNQZrrkz,         X86::VPANDNQZrmbkz,        TB_BCAST_Q },
  { X86::VPANDQZ128rrkz,       X86::VPANDQZ128rmbkz,      TB_BCAST_Q },
  { X86::VPANDQZ256rrkz,       X86::VPANDQZ256rmbkz,      TB_BCAST_Q },
  { X86::VPANDQZrrkz,          X86::VPANDQZrmbkz,         TB_BCAST_Q },
  { X86::VPCMPDZ128rrik,       X86::VPCMPDZ128rmibk,      TB_BCAST_D },
  { X86::VPCMPDZ256rrik,       X86::VPCMPDZ256rmibk,      TB_BCAST_D },
  { X86::VPCMPDZrrik,          X86::VPCMPDZrmibk,         TB_BCAST_D },
  { X86::VPCMPEQDZ128rrk,      X86::VPCMPEQDZ128rmbk,     TB_BCAST_D },
  { X86::VPCMPEQDZ256rrk,      X86::VPCMPEQDZ256rmbk,     TB_BCAST_D },
  { X86::VPCMPEQDZrrk,         X86::VPCMPEQDZrmbk,        TB_BCAST_D },
  { X86::VPCMPEQQZ128rrk,      X86::VPCMPEQQZ128rmbk,     TB_BCAST_Q },
  { X86::VPCMPEQQZ256rrk,      X86::VPCMPEQQZ256rmbk,     TB_BCAST_Q },
  { X86::VPCMPEQQZrrk,         X86::VPCMPEQQZrmbk,        TB_BCAST_Q },
  { X86::VPCMPGTDZ128rrk,      X86::VPCMPGTDZ128rmbk,     TB_BCAST_D },
  { X86::VPCMPGTDZ256rrk,      X86::VPCMPGTDZ256rmbk,     TB_BCAST_D },
  { X86::VPCMPGTDZrrk,         X86::VPCMPGTDZrmbk,        TB_BCAST_D },
  { X86::VPCMPGTQZ128rrk,      X86::VPCMPGTQZ128rmbk,     TB_BCAST_Q },
  { X86::VPCMPGTQZ256rrk,      X86::VPCMPGTQZ256rmbk,     TB_BCAST_Q },
  { X86::VPCMPGTQZrrk,         X86::VPCMPGTQZrmbk,        TB_BCAST_Q },
  { X86::VPCMPQZ128rrik,       X86::VPCMPQZ128rmibk,      TB_BCAST_Q },
  { X86::VPCMPQZ256rrik,       X86::VPCMPQZ256rmibk,      TB_BCAST_Q },
  { X86::VPCMPQZrrik,          X86::VPCMPQZrmibk,         TB_BCAST_Q },
  { X86::VPCMPUDZ128rrik,      X86::VPCMPUDZ128rmibk,     TB_BCAST_D },
  { X86::VPCMPUDZ256rrik,      X86::VPCMPUDZ256rmibk,     TB_BCAST_D },
  { X86::VPCMPUDZrrik,         X86::VPCMPUDZrmibk,        TB_BCAST_D },
  { X86::VPCMPUQZ128rrik,      X86::VPCMPUQZ128rmibk,     TB_BCAST_Q },
  { X86::VPCMPUQZ256rrik,      X86::VPCMPUQZ256rmibk,     TB_BCAST_Q },
  { X86::VPCMPUQZrrik,         X86::VPCMPUQZrmibk,        TB_BCAST_Q },
  { X86::VPMAXSDZ128rrkz,      X86::VPMAXSDZ128rmbkz,     TB_BCAST_D },
  { X86::VPMAXSDZ256rrkz,      X86::VPMAXSDZ256rmbkz,     TB_BCAST_D },
  { X86::VPMAXSDZrrkz,         X86::VPMAXSDZrmbkz,        TB_BCAST_D },
  { X86::VPMAXSQZ128rrkz,      X86::VPMAXSQZ128rmbkz,     TB_BCAST_Q },
  { X86::VPMAXSQZ256rrkz,      X86::VPMAXSQZ256rmbkz,     TB_BCAST_Q },
  { X86::VPMAXSQZrrkz,         X86::VPMAXSQZrmbkz,        TB_BCAST_Q },
  { X86::VPMAXUDZ128rrkz,      X86::VPMAXUDZ128rmbkz,     TB_BCAST_D },
  { X86::VPMAXUDZ256rrkz,      X86::VPMAXUDZ256rmbkz,     TB_BCAST_D },
  { X86::VPMAXUDZrrkz,         X86::VPMAXUDZrmbkz,        TB_BCAST_D },
  { X86::VPMAXUQZ128rrkz,      X86::VPMAXUQZ128rmbkz,     TB_BCAST_Q },
  { X86::VPMAXUQZ256rrkz,      X86::VPMAXUQZ256rmbkz,     TB_BCAST_Q },
  { X86::VPMAXUQZrrkz,         X86::VPMAXUQZrmbkz,        TB_BCAST_Q },
  { X86::VPMINSDZ128rrkz,      X86::VPMINSDZ128rmbkz,     TB_BCAST_D },
  { X86::VPMINSDZ256rrkz,      X86::VPMINSDZ256rmbkz,     TB_BCAST_D },
  { X86::VPMINSDZrrkz,         X86::VPMINSDZrmbkz,        TB_BCAST_D },
  { X86::VPMINSQZ128rrkz,      X86::VPMINSQZ128rmbkz,     TB_BCAST_Q },
  { X86::VPMINSQZ256rrkz,      X86::VPMINSQZ256rmbkz,     TB_BCAST_Q },
  { X86::VPMINSQZrrkz,         X86::VPMINSQZrmbkz,        TB_BCAST_Q },
  { X86::VPMINUDZ128rrkz,      X86::VPMINUDZ128rmbkz,     TB_BCAST_D },
  { X86::VPMINUDZ256rrkz,      X86::VPMINUDZ256rmbkz,     TB_BCAST_D },
  { X86::VPMINUDZrrkz,         X86::VPMINUDZrmbkz,        TB_BCAST_D },
  { X86::VPMINUQZ128rrkz,      X86::VPMINUQZ128rmbkz,     TB_BCAST_Q },
  { X86::VPMINUQZ256rrkz,      X86::VPMINUQZ256rmbkz,     TB_BCAST_Q },
  { X86::VPMINUQZrrkz,         X86::VPMINUQZrmbkz,        TB_BCAST_Q },
  { X86::VPMULLDZ128rrkz,      X86::VPMULLDZ128rmbkz,     TB_BCAST_D },
  { X86::VPMULLDZ256rrkz,      X86::VPMULLDZ256rmbkz,     TB_BCAST_D },
  { X86::VPMULLDZrrkz,         X86::VPMULLDZrmbkz,        TB_BCAST_D },
  { X86::VPMULLQZ128rrkz,      X86::VPMULLQZ128rmbkz,     TB_BCAST_Q },
  { X86::VPMULLQZ256rrkz,      X86::VPMULLQZ256rmbkz,     TB_BCAST_Q },
  { X86::VPMULLQZrrkz,         X86::VPMULLQZrmbkz,        TB_BCAST_Q },
  { X86::VPORDZ128rrkz,        X86::VPORDZ128rmbkz,       TB_BCAST_D },
  { X86::VPORDZ256rrkz,        X86::VPORDZ256rmbkz,       TB_BCAST_D },
  { X86::VPORDZrrkz,           X86::VPORDZrmbkz,          TB_BCAST_D },
  { X86::VPORQZ128rrkz,        X86::VPORQZ128rmbkz,       TB_BCAST_Q },
  { X86::VPORQZ256rrkz,        X86::VPORQZ256rmbkz,       TB_BCAST_Q },
  { X86::VPORQZrrkz,           X86::VPORQZrmbkz,          TB_BCAST_Q },
  { X86::VPSUBDZ128rrkz,       X86::VPSUBDZ128rmbkz,      TB_BCAST_D },
  { X86::VPSUBDZ256rrkz,       X86::VPSUBDZ256rmbkz,      TB_BCAST_D },
  { X86::VPSUBDZrrkz,          X86::VPSUBDZrmbkz,         TB_BCAST_D },
  { X86::VPSUBQZ128rrkz,       X86::VPSUBQZ128rmbkz,      TB_BCAST_Q },
  { X86::VPSUBQZ256rrkz,       X86::VPSUBQZ256rmbkz,      TB_BCAST_Q },
  { X86::VPSUBQZrrkz,          X86::VPSUBQZrmbkz,         TB_BCAST_Q },
#endif // INTEL_CUSTOMIZATION
  { X86::VPTERNLOGDZ128rri,    X86::VPTERNLOGDZ128rmbi,   TB_BCAST_D },
  { X86::VPTERNLOGDZ256rri,    X86::VPTERNLOGDZ256rmbi,   TB_BCAST_D },
  { X86::VPTERNLOGDZrri,       X86::VPTERNLOGDZrmbi,      TB_BCAST_D },
  { X86::VPTERNLOGQZ128rri,    X86::VPTERNLOGQZ128rmbi,   TB_BCAST_Q },
  { X86::VPTERNLOGQZ256rri,    X86::VPTERNLOGQZ256rmbi,   TB_BCAST_Q },
  { X86::VPTERNLOGQZrri,       X86::VPTERNLOGQZrmbi,      TB_BCAST_Q },
#if INTEL_CUSTOMIZATION
  { X86::VPTESTMDZ128rrk,      X86::VPTESTMDZ128rmbk,     TB_BCAST_D },
  { X86::VPTESTMDZ256rrk,      X86::VPTESTMDZ256rmbk,     TB_BCAST_D },
  { X86::VPTESTMDZrrk,         X86::VPTESTMDZrmbk,        TB_BCAST_D },
  { X86::VPTESTMQZ128rrk,      X86::VPTESTMQZ128rmbk,     TB_BCAST_Q },
  { X86::VPTESTMQZ256rrk,      X86::VPTESTMQZ256rmbk,     TB_BCAST_Q },
  { X86::VPTESTMQZrrk,         X86::VPTESTMQZrmbk,        TB_BCAST_Q },
  { X86::VPTESTNMDZ128rrk,     X86::VPTESTNMDZ128rmbk,    TB_BCAST_D },
  { X86::VPTESTNMDZ256rrk,     X86::VPTESTNMDZ256rmbk,    TB_BCAST_D },
  { X86::VPTESTNMDZrrk,        X86::VPTESTNMDZrmbk,       TB_BCAST_D },
  { X86::VPTESTNMQZ128rrk,     X86::VPTESTNMQZ128rmbk,    TB_BCAST_Q },
  { X86::VPTESTNMQZ256rrk,     X86::VPTESTNMQZ256rmbk,    TB_BCAST_Q },
  { X86::VPTESTNMQZrrk,        X86::VPTESTNMQZrmbk,       TB_BCAST_Q },
  { X86::VPXORDZ128rrkz,       X86::VPXORDZ128rmbkz,      TB_BCAST_D },
  { X86::VPXORDZ256rrkz,       X86::VPXORDZ256rmbkz,      TB_BCAST_D },
  { X86::VPXORDZrrkz,          X86::VPXORDZrmbkz,         TB_BCAST_D },
  { X86::VPXORQZ128rrkz,       X86::VPXORQZ128rmbkz,      TB_BCAST_Q },
  { X86::VPXORQZ256rrkz,       X86::VPXORQZ256rmbkz,      TB_BCAST_Q },
  { X86::VPXORQZrrkz,          X86::VPXORQZrmbkz,         TB_BCAST_Q },
  { X86::VSUBPDZ128rrkz,       X86::VSUBPDZ128rmbkz,      TB_BCAST_SD },
  { X86::VSUBPDZ256rrkz,       X86::VSUBPDZ256rmbkz,      TB_BCAST_SD },
  { X86::VSUBPDZrrkz,          X86::VSUBPDZrmbkz,         TB_BCAST_SD },
  { X86::VSUBPSZ128rrkz,       X86::VSUBPSZ128rmbkz,      TB_BCAST_SS },
  { X86::VSUBPSZ256rrkz,       X86::VSUBPSZ256rmbkz,      TB_BCAST_SS },
  { X86::VSUBPSZrrkz,          X86::VSUBPSZrmbkz,         TB_BCAST_SS },
#endif // INTEL_CUSTOMIZATION
};

#if INTEL_CUSTOMIZATION
static const X86MemoryFoldTableEntry BroadcastFoldTable4[] = {
  { X86::VADDPDZ128rrk,        X86::VADDPDZ128rmbk,        TB_BCAST_SD },
  { X86::VADDPDZ256rrk,        X86::VADDPDZ256rmbk,        TB_BCAST_SD },
  { X86::VADDPDZrrk,           X86::VADDPDZrmbk,           TB_BCAST_SD },
  { X86::VADDPSZ128rrk,        X86::VADDPSZ128rmbk,        TB_BCAST_SS },
  { X86::VADDPSZ256rrk,        X86::VADDPSZ256rmbk,        TB_BCAST_SS },
  { X86::VADDPSZrrk,           X86::VADDPSZrmbk,           TB_BCAST_SS },
  { X86::VDIVPDZ128rrk,        X86::VDIVPDZ128rmbk,        TB_BCAST_SD },
  { X86::VDIVPDZ256rrk,        X86::VDIVPDZ256rmbk,        TB_BCAST_SD },
  { X86::VDIVPDZrrk,           X86::VDIVPDZrmbk,           TB_BCAST_SD },
  { X86::VDIVPSZ128rrk,        X86::VDIVPSZ128rmbk,        TB_BCAST_SS },
  { X86::VDIVPSZ256rrk,        X86::VDIVPSZ256rmbk,        TB_BCAST_SS },
  { X86::VDIVPSZrrk,           X86::VDIVPSZrmbk,           TB_BCAST_SS },
  { X86::VFMADD132PDZ128rk,    X86::VFMADD132PDZ128mbk,    TB_BCAST_SD },
  { X86::VFMADD132PDZ128rkz,   X86::VFMADD132PDZ128mbkz,   TB_BCAST_SD },
  { X86::VFMADD132PDZ256rk,    X86::VFMADD132PDZ256mbk,    TB_BCAST_SD },
  { X86::VFMADD132PDZ256rkz,   X86::VFMADD132PDZ256mbkz,   TB_BCAST_SD },
  { X86::VFMADD132PDZrk,       X86::VFMADD132PDZmbk,       TB_BCAST_SD },
  { X86::VFMADD132PDZrkz,      X86::VFMADD132PDZmbkz,      TB_BCAST_SD },
  { X86::VFMADD132PSZ128rk,    X86::VFMADD132PSZ128mbk,    TB_BCAST_SS },
  { X86::VFMADD132PSZ128rkz,   X86::VFMADD132PSZ128mbkz,   TB_BCAST_SS },
  { X86::VFMADD132PSZ256rk,    X86::VFMADD132PSZ256mbk,    TB_BCAST_SS },
  { X86::VFMADD132PSZ256rkz,   X86::VFMADD132PSZ256mbkz,   TB_BCAST_SS },
  { X86::VFMADD132PSZrk,       X86::VFMADD132PSZmbk,       TB_BCAST_SS },
  { X86::VFMADD132PSZrkz,      X86::VFMADD132PSZmbkz,      TB_BCAST_SS },
  { X86::VFMADD213PDZ128rk,    X86::VFMADD213PDZ128mbk,    TB_BCAST_SD },
  { X86::VFMADD213PDZ128rkz,   X86::VFMADD213PDZ128mbkz,   TB_BCAST_SD },
  { X86::VFMADD213PDZ256rk,    X86::VFMADD213PDZ256mbk,    TB_BCAST_SD },
  { X86::VFMADD213PDZ256rkz,   X86::VFMADD213PDZ256mbkz,   TB_BCAST_SD },
  { X86::VFMADD213PDZrk,       X86::VFMADD213PDZmbk,       TB_BCAST_SD },
  { X86::VFMADD213PDZrkz,      X86::VFMADD213PDZmbkz,      TB_BCAST_SD },
  { X86::VFMADD213PSZ128rk,    X86::VFMADD213PSZ128mbk,    TB_BCAST_SS },
  { X86::VFMADD213PSZ128rkz,   X86::VFMADD213PSZ128mbkz,   TB_BCAST_SS },
  { X86::VFMADD213PSZ256rk,    X86::VFMADD213PSZ256mbk,    TB_BCAST_SS },
  { X86::VFMADD213PSZ256rkz,   X86::VFMADD213PSZ256mbkz,   TB_BCAST_SS },
  { X86::VFMADD213PSZrk,       X86::VFMADD213PSZmbk,       TB_BCAST_SS },
  { X86::VFMADD213PSZrkz,      X86::VFMADD213PSZmbkz,      TB_BCAST_SS },
  { X86::VFMADD231PDZ128rk,    X86::VFMADD231PDZ128mbk,    TB_BCAST_SD },
  { X86::VFMADD231PDZ128rkz,   X86::VFMADD231PDZ128mbkz,   TB_BCAST_SD },
  { X86::VFMADD231PDZ256rk,    X86::VFMADD231PDZ256mbk,    TB_BCAST_SD },
  { X86::VFMADD231PDZ256rkz,   X86::VFMADD231PDZ256mbkz,   TB_BCAST_SD },
  { X86::VFMADD231PDZrk,       X86::VFMADD231PDZmbk,       TB_BCAST_SD },
  { X86::VFMADD231PDZrkz,      X86::VFMADD231PDZmbkz,      TB_BCAST_SD },
  { X86::VFMADD231PSZ128rk,    X86::VFMADD231PSZ128mbk,    TB_BCAST_SS },
  { X86::VFMADD231PSZ128rkz,   X86::VFMADD231PSZ128mbkz,   TB_BCAST_SS },
  { X86::VFMADD231PSZ256rk,    X86::VFMADD231PSZ256mbk,    TB_BCAST_SS },
  { X86::VFMADD231PSZ256rkz,   X86::VFMADD231PSZ256mbkz,   TB_BCAST_SS },
  { X86::VFMADD231PSZrk,       X86::VFMADD231PSZmbk,       TB_BCAST_SS },
  { X86::VFMADD231PSZrkz,      X86::VFMADD231PSZmbkz,      TB_BCAST_SS },
  { X86::VFMADDSUB132PDZ128rk, X86::VFMADDSUB132PDZ128mbk, TB_BCAST_SD },
  { X86::VFMADDSUB132PDZ128rkz,X86::VFMADDSUB132PDZ128mbkz,TB_BCAST_SD },
  { X86::VFMADDSUB132PDZ256rk, X86::VFMADDSUB132PDZ256mbk, TB_BCAST_SD },
  { X86::VFMADDSUB132PDZ256rkz,X86::VFMADDSUB132PDZ256mbkz,TB_BCAST_SD },
  { X86::VFMADDSUB132PDZrk,    X86::VFMADDSUB132PDZmbk,    TB_BCAST_SD },
  { X86::VFMADDSUB132PDZrkz,   X86::VFMADDSUB132PDZmbkz,   TB_BCAST_SD },
  { X86::VFMADDSUB132PSZ128rk, X86::VFMADDSUB132PSZ128mbk, TB_BCAST_SS },
  { X86::VFMADDSUB132PSZ128rkz,X86::VFMADDSUB132PSZ128mbkz,TB_BCAST_SS },
  { X86::VFMADDSUB132PSZ256rk, X86::VFMADDSUB132PSZ256mbk, TB_BCAST_SS },
  { X86::VFMADDSUB132PSZ256rkz,X86::VFMADDSUB132PSZ256mbkz,TB_BCAST_SS },
  { X86::VFMADDSUB132PSZrk,    X86::VFMADDSUB132PSZmbk,    TB_BCAST_SS },
  { X86::VFMADDSUB132PSZrkz,   X86::VFMADDSUB132PSZmbkz,   TB_BCAST_SS },
  { X86::VFMADDSUB213PDZ128rk, X86::VFMADDSUB213PDZ128mbk, TB_BCAST_SD },
  { X86::VFMADDSUB213PDZ128rkz,X86::VFMADDSUB213PDZ128mbkz,TB_BCAST_SD },
  { X86::VFMADDSUB213PDZ256rk, X86::VFMADDSUB213PDZ256mbk, TB_BCAST_SD },
  { X86::VFMADDSUB213PDZ256rkz,X86::VFMADDSUB213PDZ256mbkz,TB_BCAST_SD },
  { X86::VFMADDSUB213PDZrk,    X86::VFMADDSUB213PDZmbk,    TB_BCAST_SD },
  { X86::VFMADDSUB213PDZrkz,   X86::VFMADDSUB213PDZmbkz,   TB_BCAST_SD },
  { X86::VFMADDSUB213PSZ128rk, X86::VFMADDSUB213PSZ128mbk, TB_BCAST_SS },
  { X86::VFMADDSUB213PSZ128rkz,X86::VFMADDSUB213PSZ128mbkz,TB_BCAST_SS },
  { X86::VFMADDSUB213PSZ256rk, X86::VFMADDSUB213PSZ256mbk, TB_BCAST_SS },
  { X86::VFMADDSUB213PSZ256rkz,X86::VFMADDSUB213PSZ256mbkz,TB_BCAST_SS },
  { X86::VFMADDSUB213PSZrk,    X86::VFMADDSUB213PSZmbk,    TB_BCAST_SS },
  { X86::VFMADDSUB213PSZrkz,   X86::VFMADDSUB213PSZmbkz,   TB_BCAST_SS },
  { X86::VFMADDSUB231PDZ128rk, X86::VFMADDSUB231PDZ128mbk, TB_BCAST_SD },
  { X86::VFMADDSUB231PDZ128rkz,X86::VFMADDSUB231PDZ128mbkz,TB_BCAST_SD },
  { X86::VFMADDSUB231PDZ256rk, X86::VFMADDSUB231PDZ256mbk, TB_BCAST_SD },
  { X86::VFMADDSUB231PDZ256rkz,X86::VFMADDSUB231PDZ256mbkz,TB_BCAST_SD },
  { X86::VFMADDSUB231PDZrk,    X86::VFMADDSUB231PDZmbk,    TB_BCAST_SD },
  { X86::VFMADDSUB231PDZrkz,   X86::VFMADDSUB231PDZmbkz,   TB_BCAST_SD },
  { X86::VFMADDSUB231PSZ128rk, X86::VFMADDSUB231PSZ128mbk, TB_BCAST_SS },
  { X86::VFMADDSUB231PSZ128rkz,X86::VFMADDSUB231PSZ128mbkz,TB_BCAST_SS },
  { X86::VFMADDSUB231PSZ256rk, X86::VFMADDSUB231PSZ256mbk, TB_BCAST_SS },
  { X86::VFMADDSUB231PSZ256rkz,X86::VFMADDSUB231PSZ256mbkz,TB_BCAST_SS },
  { X86::VFMADDSUB231PSZrk,    X86::VFMADDSUB231PSZmbk,    TB_BCAST_SS },
  { X86::VFMADDSUB231PSZrkz,   X86::VFMADDSUB231PSZmbkz,   TB_BCAST_SS },
  { X86::VFMSUB132PDZ128rk,    X86::VFMSUB132PDZ128mbk,    TB_BCAST_SD },
  { X86::VFMSUB132PDZ128rkz,   X86::VFMSUB132PDZ128mbkz,   TB_BCAST_SD },
  { X86::VFMSUB132PDZ256rk,    X86::VFMSUB132PDZ256mbk,    TB_BCAST_SD },
  { X86::VFMSUB132PDZ256rkz,   X86::VFMSUB132PDZ256mbkz,   TB_BCAST_SD },
  { X86::VFMSUB132PDZrk,       X86::VFMSUB132PDZmbk,       TB_BCAST_SD },
  { X86::VFMSUB132PDZrkz,      X86::VFMSUB132PDZmbkz,      TB_BCAST_SD },
  { X86::VFMSUB132PSZ128rk,    X86::VFMSUB132PSZ128mbk,    TB_BCAST_SS },
  { X86::VFMSUB132PSZ128rkz,   X86::VFMSUB132PSZ128mbkz,   TB_BCAST_SS },
  { X86::VFMSUB132PSZ256rk,    X86::VFMSUB132PSZ256mbk,    TB_BCAST_SS },
  { X86::VFMSUB132PSZ256rkz,   X86::VFMSUB132PSZ256mbkz,   TB_BCAST_SS },
  { X86::VFMSUB132PSZrk,       X86::VFMSUB132PSZmbk,       TB_BCAST_SS },
  { X86::VFMSUB132PSZrkz,      X86::VFMSUB132PSZmbkz,      TB_BCAST_SS },
  { X86::VFMSUB213PDZ128rk,    X86::VFMSUB213PDZ128mbk,    TB_BCAST_SD },
  { X86::VFMSUB213PDZ128rkz,   X86::VFMSUB213PDZ128mbkz,   TB_BCAST_SD },
  { X86::VFMSUB213PDZ256rk,    X86::VFMSUB213PDZ256mbk,    TB_BCAST_SD },
  { X86::VFMSUB213PDZ256rkz,   X86::VFMSUB213PDZ256mbkz,   TB_BCAST_SD },
  { X86::VFMSUB213PDZrk,       X86::VFMSUB213PDZmbk,       TB_BCAST_SD },
  { X86::VFMSUB213PDZrkz,      X86::VFMSUB213PDZmbkz,      TB_BCAST_SD },
  { X86::VFMSUB213PSZ128rk,    X86::VFMSUB213PSZ128mbk,    TB_BCAST_SS },
  { X86::VFMSUB213PSZ128rkz,   X86::VFMSUB213PSZ128mbkz,   TB_BCAST_SS },
  { X86::VFMSUB213PSZ256rk,    X86::VFMSUB213PSZ256mbk,    TB_BCAST_SS },
  { X86::VFMSUB213PSZ256rkz,   X86::VFMSUB213PSZ256mbkz,   TB_BCAST_SS },
  { X86::VFMSUB213PSZrk,       X86::VFMSUB213PSZmbk,       TB_BCAST_SS },
  { X86::VFMSUB213PSZrkz,      X86::VFMSUB213PSZmbkz,      TB_BCAST_SS },
  { X86::VFMSUB231PDZ128rk,    X86::VFMSUB231PDZ128mbk,    TB_BCAST_SD },
  { X86::VFMSUB231PDZ128rkz,   X86::VFMSUB231PDZ128mbkz,   TB_BCAST_SD },
  { X86::VFMSUB231PDZ256rk,    X86::VFMSUB231PDZ256mbk,    TB_BCAST_SD },
  { X86::VFMSUB231PDZ256rkz,   X86::VFMSUB231PDZ256mbkz,   TB_BCAST_SD },
  { X86::VFMSUB231PDZrk,       X86::VFMSUB231PDZmbk,       TB_BCAST_SD },
  { X86::VFMSUB231PDZrkz,      X86::VFMSUB231PDZmbkz,      TB_BCAST_SD },
  { X86::VFMSUB231PSZ128rk,    X86::VFMSUB231PSZ128mbk,    TB_BCAST_SS },
  { X86::VFMSUB231PSZ128rkz,   X86::VFMSUB231PSZ128mbkz,   TB_BCAST_SS },
  { X86::VFMSUB231PSZ256rk,    X86::VFMSUB231PSZ256mbk,    TB_BCAST_SS },
  { X86::VFMSUB231PSZ256rkz,   X86::VFMSUB231PSZ256mbkz,   TB_BCAST_SS },
  { X86::VFMSUB231PSZrk,       X86::VFMSUB231PSZmbk,       TB_BCAST_SS },
  { X86::VFMSUB231PSZrkz,      X86::VFMSUB231PSZmbkz,      TB_BCAST_SS },
  { X86::VFMSUBADD132PDZ128rk, X86::VFMSUBADD132PDZ128mbk, TB_BCAST_SD },
  { X86::VFMSUBADD132PDZ128rkz,X86::VFMSUBADD132PDZ128mbkz,TB_BCAST_SD },
  { X86::VFMSUBADD132PDZ256rk, X86::VFMSUBADD132PDZ256mbk, TB_BCAST_SD },
  { X86::VFMSUBADD132PDZ256rkz,X86::VFMSUBADD132PDZ256mbkz,TB_BCAST_SD },
  { X86::VFMSUBADD132PDZrk,    X86::VFMSUBADD132PDZmbk,    TB_BCAST_SD },
  { X86::VFMSUBADD132PDZrkz,   X86::VFMSUBADD132PDZmbkz,   TB_BCAST_SD },
  { X86::VFMSUBADD132PSZ128rk, X86::VFMSUBADD132PSZ128mbk, TB_BCAST_SS },
  { X86::VFMSUBADD132PSZ128rkz,X86::VFMSUBADD132PSZ128mbkz,TB_BCAST_SS },
  { X86::VFMSUBADD132PSZ256rk, X86::VFMSUBADD132PSZ256mbk, TB_BCAST_SS },
  { X86::VFMSUBADD132PSZ256rkz,X86::VFMSUBADD132PSZ256mbkz,TB_BCAST_SS },
  { X86::VFMSUBADD132PSZrk,    X86::VFMSUBADD132PSZmbk,    TB_BCAST_SS },
  { X86::VFMSUBADD132PSZrkz,   X86::VFMSUBADD132PSZmbkz,   TB_BCAST_SS },
  { X86::VFMSUBADD213PDZ128rk, X86::VFMSUBADD213PDZ128mbk, TB_BCAST_SD },
  { X86::VFMSUBADD213PDZ128rkz,X86::VFMSUBADD213PDZ128mbkz,TB_BCAST_SD },
  { X86::VFMSUBADD213PDZ256rk, X86::VFMSUBADD213PDZ256mbk, TB_BCAST_SD },
  { X86::VFMSUBADD213PDZ256rkz,X86::VFMSUBADD213PDZ256mbkz,TB_BCAST_SD },
  { X86::VFMSUBADD213PDZrk,    X86::VFMSUBADD213PDZmbk,    TB_BCAST_SD },
  { X86::VFMSUBADD213PDZrkz,   X86::VFMSUBADD213PDZmbkz,   TB_BCAST_SD },
  { X86::VFMSUBADD213PSZ128rk, X86::VFMSUBADD213PSZ128mbk, TB_BCAST_SS },
  { X86::VFMSUBADD213PSZ128rkz,X86::VFMSUBADD213PSZ128mbkz,TB_BCAST_SS },
  { X86::VFMSUBADD213PSZ256rk, X86::VFMSUBADD213PSZ256mbk, TB_BCAST_SS },
  { X86::VFMSUBADD213PSZ256rkz,X86::VFMSUBADD213PSZ256mbkz,TB_BCAST_SS },
  { X86::VFMSUBADD213PSZrk,    X86::VFMSUBADD213PSZmbk,    TB_BCAST_SS },
  { X86::VFMSUBADD213PSZrkz,   X86::VFMSUBADD213PSZmbkz,   TB_BCAST_SS },
  { X86::VFMSUBADD231PDZ128rk, X86::VFMSUBADD231PDZ128mbk, TB_BCAST_SD },
  { X86::VFMSUBADD231PDZ128rkz,X86::VFMSUBADD231PDZ128mbkz,TB_BCAST_SD },
  { X86::VFMSUBADD231PDZ256rk, X86::VFMSUBADD231PDZ256mbk, TB_BCAST_SD },
  { X86::VFMSUBADD231PDZ256rkz,X86::VFMSUBADD231PDZ256mbkz,TB_BCAST_SD },
  { X86::VFMSUBADD231PDZrk,    X86::VFMSUBADD231PDZmbk,    TB_BCAST_SD },
  { X86::VFMSUBADD231PDZrkz,   X86::VFMSUBADD231PDZmbkz,   TB_BCAST_SD },
  { X86::VFMSUBADD231PSZ128rk, X86::VFMSUBADD231PSZ128mbk, TB_BCAST_SS },
  { X86::VFMSUBADD231PSZ128rkz,X86::VFMSUBADD231PSZ128mbkz,TB_BCAST_SS },
  { X86::VFMSUBADD231PSZ256rk, X86::VFMSUBADD231PSZ256mbk, TB_BCAST_SS },
  { X86::VFMSUBADD231PSZ256rkz,X86::VFMSUBADD231PSZ256mbkz,TB_BCAST_SS },
  { X86::VFMSUBADD231PSZrk,    X86::VFMSUBADD231PSZmbk,    TB_BCAST_SS },
  { X86::VFMSUBADD231PSZrkz,   X86::VFMSUBADD231PSZmbkz,   TB_BCAST_SS },
  { X86::VFNMADD132PDZ128rk,   X86::VFNMADD132PDZ128mbk,   TB_BCAST_SD },
  { X86::VFNMADD132PDZ128rkz,  X86::VFNMADD132PDZ128mbkz,  TB_BCAST_SD },
  { X86::VFNMADD132PDZ256rk,   X86::VFNMADD132PDZ256mbk,   TB_BCAST_SD },
  { X86::VFNMADD132PDZ256rkz,  X86::VFNMADD132PDZ256mbkz,  TB_BCAST_SD },
  { X86::VFNMADD132PDZrk,      X86::VFNMADD132PDZmbk,      TB_BCAST_SD },
  { X86::VFNMADD132PDZrkz,     X86::VFNMADD132PDZmbkz,     TB_BCAST_SD },
  { X86::VFNMADD132PSZ128rk,   X86::VFNMADD132PSZ128mbk,   TB_BCAST_SS },
  { X86::VFNMADD132PSZ128rkz,  X86::VFNMADD132PSZ128mbkz,  TB_BCAST_SS },
  { X86::VFNMADD132PSZ256rk,   X86::VFNMADD132PSZ256mbk,   TB_BCAST_SS },
  { X86::VFNMADD132PSZ256rkz,  X86::VFNMADD132PSZ256mbkz,  TB_BCAST_SS },
  { X86::VFNMADD132PSZrk,      X86::VFNMADD132PSZmbk,      TB_BCAST_SS },
  { X86::VFNMADD132PSZrkz,     X86::VFNMADD132PSZmbkz,     TB_BCAST_SS },
  { X86::VFNMADD213PDZ128rk,   X86::VFNMADD213PDZ128mbk,   TB_BCAST_SD },
  { X86::VFNMADD213PDZ128rkz,  X86::VFNMADD213PDZ128mbkz,  TB_BCAST_SD },
  { X86::VFNMADD213PDZ256rk,   X86::VFNMADD213PDZ256mbk,   TB_BCAST_SD },
  { X86::VFNMADD213PDZ256rkz,  X86::VFNMADD213PDZ256mbkz,  TB_BCAST_SD },
  { X86::VFNMADD213PDZrk,      X86::VFNMADD213PDZmbk,      TB_BCAST_SD },
  { X86::VFNMADD213PDZrkz,     X86::VFNMADD213PDZmbkz,     TB_BCAST_SD },
  { X86::VFNMADD213PSZ128rk,   X86::VFNMADD213PSZ128mbk,   TB_BCAST_SS },
  { X86::VFNMADD213PSZ128rkz,  X86::VFNMADD213PSZ128mbkz,  TB_BCAST_SS },
  { X86::VFNMADD213PSZ256rk,   X86::VFNMADD213PSZ256mbk,   TB_BCAST_SS },
  { X86::VFNMADD213PSZ256rkz,  X86::VFNMADD213PSZ256mbkz,  TB_BCAST_SS },
  { X86::VFNMADD213PSZrk,      X86::VFNMADD213PSZmbk,      TB_BCAST_SS },
  { X86::VFNMADD213PSZrkz,     X86::VFNMADD213PSZmbkz,     TB_BCAST_SS },
  { X86::VFNMADD231PDZ128rk,   X86::VFNMADD231PDZ128mbk,   TB_BCAST_SD },
  { X86::VFNMADD231PDZ128rkz,  X86::VFNMADD231PDZ128mbkz,  TB_BCAST_SD },
  { X86::VFNMADD231PDZ256rk,   X86::VFNMADD231PDZ256mbk,   TB_BCAST_SD },
  { X86::VFNMADD231PDZ256rkz,  X86::VFNMADD231PDZ256mbkz,  TB_BCAST_SD },
  { X86::VFNMADD231PDZrk,      X86::VFNMADD231PDZmbk,      TB_BCAST_SD },
  { X86::VFNMADD231PDZrkz,     X86::VFNMADD231PDZmbkz,     TB_BCAST_SD },
  { X86::VFNMADD231PSZ128rk,   X86::VFNMADD231PSZ128mbk,   TB_BCAST_SS },
  { X86::VFNMADD231PSZ128rkz,  X86::VFNMADD231PSZ128mbkz,  TB_BCAST_SS },
  { X86::VFNMADD231PSZ256rk,   X86::VFNMADD231PSZ256mbk,   TB_BCAST_SS },
  { X86::VFNMADD231PSZ256rkz,  X86::VFNMADD231PSZ256mbkz,  TB_BCAST_SS },
  { X86::VFNMADD231PSZrk,      X86::VFNMADD231PSZmbk,      TB_BCAST_SS },
  { X86::VFNMADD231PSZrkz,     X86::VFNMADD231PSZmbkz,     TB_BCAST_SS },
  { X86::VFNMSUB132PDZ128rk,   X86::VFNMSUB132PDZ128mbk,   TB_BCAST_SD },
  { X86::VFNMSUB132PDZ128rkz,  X86::VFNMSUB132PDZ128mbkz,  TB_BCAST_SD },
  { X86::VFNMSUB132PDZ256rk,   X86::VFNMSUB132PDZ256mbk,   TB_BCAST_SD },
  { X86::VFNMSUB132PDZ256rkz,  X86::VFNMSUB132PDZ256mbkz,  TB_BCAST_SD },
  { X86::VFNMSUB132PDZrk,      X86::VFNMSUB132PDZmbk,      TB_BCAST_SD },
  { X86::VFNMSUB132PDZrkz,     X86::VFNMSUB132PDZmbkz,     TB_BCAST_SD },
  { X86::VFNMSUB132PSZ128rk,   X86::VFNMSUB132PSZ128mbk,   TB_BCAST_SS },
  { X86::VFNMSUB132PSZ128rkz,  X86::VFNMSUB132PSZ128mbkz,  TB_BCAST_SS },
  { X86::VFNMSUB132PSZ256rk,   X86::VFNMSUB132PSZ256mbk,   TB_BCAST_SS },
  { X86::VFNMSUB132PSZ256rkz,  X86::VFNMSUB132PSZ256mbkz,  TB_BCAST_SS },
  { X86::VFNMSUB132PSZrk,      X86::VFNMSUB132PSZmbk,      TB_BCAST_SS },
  { X86::VFNMSUB132PSZrkz,     X86::VFNMSUB132PSZmbkz,     TB_BCAST_SS },
  { X86::VFNMSUB213PDZ128rk,   X86::VFNMSUB213PDZ128mbk,   TB_BCAST_SD },
  { X86::VFNMSUB213PDZ128rkz,  X86::VFNMSUB213PDZ128mbkz,  TB_BCAST_SD },
  { X86::VFNMSUB213PDZ256rk,   X86::VFNMSUB213PDZ256mbk,   TB_BCAST_SD },
  { X86::VFNMSUB213PDZ256rkz,  X86::VFNMSUB213PDZ256mbkz,  TB_BCAST_SD },
  { X86::VFNMSUB213PDZrk,      X86::VFNMSUB213PDZmbk,      TB_BCAST_SD },
  { X86::VFNMSUB213PDZrkz,     X86::VFNMSUB213PDZmbkz,     TB_BCAST_SD },
  { X86::VFNMSUB213PSZ128rk,   X86::VFNMSUB213PSZ128mbk,   TB_BCAST_SS },
  { X86::VFNMSUB213PSZ128rkz,  X86::VFNMSUB213PSZ128mbkz,  TB_BCAST_SS },
  { X86::VFNMSUB213PSZ256rk,   X86::VFNMSUB213PSZ256mbk,   TB_BCAST_SS },
  { X86::VFNMSUB213PSZ256rkz,  X86::VFNMSUB213PSZ256mbkz,  TB_BCAST_SS },
  { X86::VFNMSUB213PSZrk,      X86::VFNMSUB213PSZmbk,      TB_BCAST_SS },
  { X86::VFNMSUB213PSZrkz,     X86::VFNMSUB213PSZmbkz,     TB_BCAST_SS },
  { X86::VFNMSUB231PDZ128rk,   X86::VFNMSUB231PDZ128mbk,   TB_BCAST_SD },
  { X86::VFNMSUB231PDZ128rkz,  X86::VFNMSUB231PDZ128mbkz,  TB_BCAST_SD },
  { X86::VFNMSUB231PDZ256rk,   X86::VFNMSUB231PDZ256mbk,   TB_BCAST_SD },
  { X86::VFNMSUB231PDZ256rkz,  X86::VFNMSUB231PDZ256mbkz,  TB_BCAST_SD },
  { X86::VFNMSUB231PDZrk,      X86::VFNMSUB231PDZmbk,      TB_BCAST_SD },
  { X86::VFNMSUB231PDZrkz,     X86::VFNMSUB231PDZmbkz,     TB_BCAST_SD },
  { X86::VFNMSUB231PSZ128rk,   X86::VFNMSUB231PSZ128mbk,   TB_BCAST_SS },
  { X86::VFNMSUB231PSZ128rkz,  X86::VFNMSUB231PSZ128mbkz,  TB_BCAST_SS },
  { X86::VFNMSUB231PSZ256rk,   X86::VFNMSUB231PSZ256mbk,   TB_BCAST_SS },
  { X86::VFNMSUB231PSZ256rkz,  X86::VFNMSUB231PSZ256mbkz,  TB_BCAST_SS },
  { X86::VFNMSUB231PSZrk,      X86::VFNMSUB231PSZmbk,      TB_BCAST_SS },
  { X86::VFNMSUB231PSZrkz,     X86::VFNMSUB231PSZmbkz,     TB_BCAST_SS },
  { X86::VMAXCPDZ128rrk,       X86::VMAXCPDZ128rmbk,       TB_BCAST_SD },
  { X86::VMAXCPDZ256rrk,       X86::VMAXCPDZ256rmbk,       TB_BCAST_SD },
  { X86::VMAXCPDZrrk,          X86::VMAXCPDZrmbk,          TB_BCAST_SD },
  { X86::VMAXCPSZ128rrk,       X86::VMAXCPSZ128rmbk,       TB_BCAST_SS },
  { X86::VMAXCPSZ256rrk,       X86::VMAXCPSZ256rmbk,       TB_BCAST_SS },
  { X86::VMAXCPSZrrk,          X86::VMAXCPSZrmbk,          TB_BCAST_SS },
  { X86::VMAXPDZ128rrk,        X86::VMAXPDZ128rmbk,        TB_BCAST_SD },
  { X86::VMAXPDZ256rrk,        X86::VMAXPDZ256rmbk,        TB_BCAST_SD },
  { X86::VMAXPDZrrk,           X86::VMAXPDZrmbk,           TB_BCAST_SD },
  { X86::VMAXPSZ128rrk,        X86::VMAXPSZ128rmbk,        TB_BCAST_SS },
  { X86::VMAXPSZ256rrk,        X86::VMAXPSZ256rmbk,        TB_BCAST_SS },
  { X86::VMAXPSZrrk,           X86::VMAXPSZrmbk,           TB_BCAST_SS },
  { X86::VMINCPDZ128rrk,       X86::VMINCPDZ128rmbk,       TB_BCAST_SD },
  { X86::VMINCPDZ256rrk,       X86::VMINCPDZ256rmbk,       TB_BCAST_SD },
  { X86::VMINCPDZrrk,          X86::VMINCPDZrmbk,          TB_BCAST_SD },
  { X86::VMINCPSZ128rrk,       X86::VMINCPSZ128rmbk,       TB_BCAST_SS },
  { X86::VMINCPSZ256rrk,       X86::VMINCPSZ256rmbk,       TB_BCAST_SS },
  { X86::VMINCPSZrrk,          X86::VMINCPSZrmbk,          TB_BCAST_SS },
  { X86::VMINPDZ128rrk,        X86::VMINPDZ128rmbk,        TB_BCAST_SD },
  { X86::VMINPDZ256rrk,        X86::VMINPDZ256rmbk,        TB_BCAST_SD },
  { X86::VMINPDZrrk,           X86::VMINPDZrmbk,           TB_BCAST_SD },
  { X86::VMINPSZ128rrk,        X86::VMINPSZ128rmbk,        TB_BCAST_SS },
  { X86::VMINPSZ256rrk,        X86::VMINPSZ256rmbk,        TB_BCAST_SS },
  { X86::VMINPSZrrk,           X86::VMINPSZrmbk,           TB_BCAST_SS },
  { X86::VMULPDZ128rrk,        X86::VMULPDZ128rmbk,        TB_BCAST_SD },
  { X86::VMULPDZ256rrk,        X86::VMULPDZ256rmbk,        TB_BCAST_SD },
  { X86::VMULPDZrrk,           X86::VMULPDZrmbk,           TB_BCAST_SD },
  { X86::VMULPSZ128rrk,        X86::VMULPSZ128rmbk,        TB_BCAST_SS },
  { X86::VMULPSZ256rrk,        X86::VMULPSZ256rmbk,        TB_BCAST_SS },
  { X86::VMULPSZrrk,           X86::VMULPSZrmbk,           TB_BCAST_SS },
  { X86::VPADDDZ128rrk,        X86::VPADDDZ128rmbk,        TB_BCAST_D },
  { X86::VPADDDZ256rrk,        X86::VPADDDZ256rmbk,        TB_BCAST_D },
  { X86::VPADDDZrrk,           X86::VPADDDZrmbk,           TB_BCAST_D },
  { X86::VPADDQZ128rrk,        X86::VPADDQZ128rmbk,        TB_BCAST_Q },
  { X86::VPADDQZ256rrk,        X86::VPADDQZ256rmbk,        TB_BCAST_Q },
  { X86::VPADDQZrrk,           X86::VPADDQZrmbk,           TB_BCAST_Q },
  { X86::VPANDDZ128rrk,        X86::VPANDDZ128rmbk,        TB_BCAST_D },
  { X86::VPANDDZ256rrk,        X86::VPANDDZ256rmbk,        TB_BCAST_D },
  { X86::VPANDDZrrk,           X86::VPANDDZrmbk,           TB_BCAST_D },
  { X86::VPANDNDZ128rrk,       X86::VPANDNDZ128rmbk,       TB_BCAST_D },
  { X86::VPANDNDZ256rrk,       X86::VPANDNDZ256rmbk,       TB_BCAST_D },
  { X86::VPANDNDZrrk,          X86::VPANDNDZrmbk,          TB_BCAST_D },
  { X86::VPANDNQZ128rrk,       X86::VPANDNQZ128rmbk,       TB_BCAST_Q },
  { X86::VPANDNQZ256rrk,       X86::VPANDNQZ256rmbk,       TB_BCAST_Q },
  { X86::VPANDNQZrrk,          X86::VPANDNQZrmbk,          TB_BCAST_Q },
  { X86::VPANDQZ128rrk,        X86::VPANDQZ128rmbk,        TB_BCAST_Q },
  { X86::VPANDQZ256rrk,        X86::VPANDQZ256rmbk,        TB_BCAST_Q },
  { X86::VPANDQZrrk,           X86::VPANDQZrmbk,           TB_BCAST_Q },
  { X86::VPMAXSDZ128rrk,       X86::VPMAXSDZ128rmbk,       TB_BCAST_D },
  { X86::VPMAXSDZ256rrk,       X86::VPMAXSDZ256rmbk,       TB_BCAST_D },
  { X86::VPMAXSDZrrk,          X86::VPMAXSDZrmbk,          TB_BCAST_D },
  { X86::VPMAXSQZ128rrk,       X86::VPMAXSQZ128rmbk,       TB_BCAST_Q },
  { X86::VPMAXSQZ256rrk,       X86::VPMAXSQZ256rmbk,       TB_BCAST_Q },
  { X86::VPMAXSQZrrk,          X86::VPMAXSQZrmbk,          TB_BCAST_Q },
  { X86::VPMAXUDZ128rrk,       X86::VPMAXUDZ128rmbk,       TB_BCAST_D },
  { X86::VPMAXUDZ256rrk,       X86::VPMAXUDZ256rmbk,       TB_BCAST_D },
  { X86::VPMAXUDZrrk,          X86::VPMAXUDZrmbk,          TB_BCAST_D },
  { X86::VPMAXUQZ128rrk,       X86::VPMAXUQZ128rmbk,       TB_BCAST_Q },
  { X86::VPMAXUQZ256rrk,       X86::VPMAXUQZ256rmbk,       TB_BCAST_Q },
  { X86::VPMAXUQZrrk,          X86::VPMAXUQZrmbk,          TB_BCAST_Q },
  { X86::VPMINSDZ128rrk,       X86::VPMINSDZ128rmbk,       TB_BCAST_D },
  { X86::VPMINSDZ256rrk,       X86::VPMINSDZ256rmbk,       TB_BCAST_D },
  { X86::VPMINSDZrrk,          X86::VPMINSDZrmbk,          TB_BCAST_D },
  { X86::VPMINSQZ128rrk,       X86::VPMINSQZ128rmbk,       TB_BCAST_Q },
  { X86::VPMINSQZ256rrk,       X86::VPMINSQZ256rmbk,       TB_BCAST_Q },
  { X86::VPMINSQZrrk,          X86::VPMINSQZrmbk,          TB_BCAST_Q },
  { X86::VPMINUDZ128rrk,       X86::VPMINUDZ128rmbk,       TB_BCAST_D },
  { X86::VPMINUDZ256rrk,       X86::VPMINUDZ256rmbk,       TB_BCAST_D },
  { X86::VPMINUDZrrk,          X86::VPMINUDZrmbk,          TB_BCAST_D },
  { X86::VPMINUQZ128rrk,       X86::VPMINUQZ128rmbk,       TB_BCAST_Q },
  { X86::VPMINUQZ256rrk,       X86::VPMINUQZ256rmbk,       TB_BCAST_Q },
  { X86::VPMINUQZrrk,          X86::VPMINUQZrmbk,          TB_BCAST_Q },
  { X86::VPMULLDZ128rrk,       X86::VPMULLDZ128rmbk,       TB_BCAST_D },
  { X86::VPMULLDZ256rrk,       X86::VPMULLDZ256rmbk,       TB_BCAST_D },
  { X86::VPMULLDZrrk,          X86::VPMULLDZrmbk,          TB_BCAST_D },
  { X86::VPMULLQZ128rrk,       X86::VPMULLQZ128rmbk,       TB_BCAST_Q },
  { X86::VPMULLQZ256rrk,       X86::VPMULLQZ256rmbk,       TB_BCAST_Q },
  { X86::VPMULLQZrrk,          X86::VPMULLQZrmbk,          TB_BCAST_Q },
  { X86::VPORDZ128rrk,         X86::VPORDZ128rmbk,         TB_BCAST_D },
  { X86::VPORDZ256rrk,         X86::VPORDZ256rmbk,         TB_BCAST_D },
  { X86::VPORDZrrk,            X86::VPORDZrmbk,            TB_BCAST_D },
  { X86::VPORQZ128rrk,         X86::VPORQZ128rmbk,         TB_BCAST_Q },
  { X86::VPORQZ256rrk,         X86::VPORQZ256rmbk,         TB_BCAST_Q },
  { X86::VPORQZrrk,            X86::VPORQZrmbk,            TB_BCAST_Q },
  { X86::VPSUBDZ128rrk,        X86::VPSUBDZ128rmbk,        TB_BCAST_D },
  { X86::VPSUBDZ256rrk,        X86::VPSUBDZ256rmbk,        TB_BCAST_D },
  { X86::VPSUBDZrrk,           X86::VPSUBDZrmbk,           TB_BCAST_D },
  { X86::VPSUBQZ128rrk,        X86::VPSUBQZ128rmbk,        TB_BCAST_Q },
  { X86::VPSUBQZ256rrk,        X86::VPSUBQZ256rmbk,        TB_BCAST_Q },
  { X86::VPSUBQZrrk,           X86::VPSUBQZrmbk,           TB_BCAST_Q },
  { X86::VPXORDZ128rrk,        X86::VPXORDZ128rmbk,        TB_BCAST_D },
  { X86::VPXORDZ256rrk,        X86::VPXORDZ256rmbk,        TB_BCAST_D },
  { X86::VPXORDZrrk,           X86::VPXORDZrmbk,           TB_BCAST_D },
  { X86::VPXORQZ128rrk,        X86::VPXORQZ128rmbk,        TB_BCAST_Q },
  { X86::VPXORQZ256rrk,        X86::VPXORQZ256rmbk,        TB_BCAST_Q },
  { X86::VPXORQZrrk,           X86::VPXORQZrmbk,           TB_BCAST_Q },
  { X86::VSUBPDZ128rrk,        X86::VSUBPDZ128rmbk,        TB_BCAST_SD },
  { X86::VSUBPDZ256rrk,        X86::VSUBPDZ256rmbk,        TB_BCAST_SD },
  { X86::VSUBPDZrrk,           X86::VSUBPDZrmbk,           TB_BCAST_SD },
  { X86::VSUBPSZ128rrk,        X86::VSUBPSZ128rmbk,        TB_BCAST_SS },
  { X86::VSUBPSZ256rrk,        X86::VSUBPSZ256rmbk,        TB_BCAST_SS },
  { X86::VSUBPSZrrk,           X86::VSUBPSZrmbk,           TB_BCAST_SS },
};
#endif // INTEL_CUSTOMIZATION
// Table to map instructions safe to broadcast using a different width from the
// element width.
static const X86MemoryFoldTableEntry BroadcastSizeFoldTable2[] = {
  { X86::VANDNPDZ128rr,        X86::VANDNPSZ128rmb,       TB_BCAST_SS },
  { X86::VANDNPDZ256rr,        X86::VANDNPSZ256rmb,       TB_BCAST_SS },
  { X86::VANDNPDZrr,           X86::VANDNPSZrmb,          TB_BCAST_SS },
  { X86::VANDNPSZ128rr,        X86::VANDNPDZ128rmb,       TB_BCAST_SD },
  { X86::VANDNPSZ256rr,        X86::VANDNPDZ256rmb,       TB_BCAST_SD },
  { X86::VANDNPSZrr,           X86::VANDNPDZrmb,          TB_BCAST_SD },
  { X86::VANDPDZ128rr,         X86::VANDPSZ128rmb,        TB_BCAST_SS },
  { X86::VANDPDZ256rr,         X86::VANDPSZ256rmb,        TB_BCAST_SS },
  { X86::VANDPDZrr,            X86::VANDPSZrmb,           TB_BCAST_SS },
  { X86::VANDPSZ128rr,         X86::VANDPDZ128rmb,        TB_BCAST_SD },
  { X86::VANDPSZ256rr,         X86::VANDPDZ256rmb,        TB_BCAST_SD },
  { X86::VANDPSZrr,            X86::VANDPDZrmb,           TB_BCAST_SD },
  { X86::VORPDZ128rr,          X86::VORPSZ128rmb,         TB_BCAST_SS },
  { X86::VORPDZ256rr,          X86::VORPSZ256rmb,         TB_BCAST_SS },
  { X86::VORPDZrr,             X86::VORPSZrmb,            TB_BCAST_SS },
  { X86::VORPSZ128rr,          X86::VORPDZ128rmb,         TB_BCAST_SD },
  { X86::VORPSZ256rr,          X86::VORPDZ256rmb,         TB_BCAST_SD },
  { X86::VORPSZrr,             X86::VORPDZrmb,            TB_BCAST_SD },
  { X86::VPANDDZ128rr,         X86::VPANDQZ128rmb,        TB_BCAST_Q },
  { X86::VPANDDZ256rr,         X86::VPANDQZ256rmb,        TB_BCAST_Q },
  { X86::VPANDDZrr,            X86::VPANDQZrmb,           TB_BCAST_Q },
  { X86::VPANDNDZ128rr,        X86::VPANDNQZ128rmb,       TB_BCAST_Q },
  { X86::VPANDNDZ256rr,        X86::VPANDNQZ256rmb,       TB_BCAST_Q },
  { X86::VPANDNDZrr,           X86::VPANDNQZrmb,          TB_BCAST_Q },
  { X86::VPANDNQZ128rr,        X86::VPANDNDZ128rmb,       TB_BCAST_D },
  { X86::VPANDNQZ256rr,        X86::VPANDNDZ256rmb,       TB_BCAST_D },
  { X86::VPANDNQZrr,           X86::VPANDNDZrmb,          TB_BCAST_D },
  { X86::VPANDQZ128rr,         X86::VPANDDZ128rmb,        TB_BCAST_D },
  { X86::VPANDQZ256rr,         X86::VPANDDZ256rmb,        TB_BCAST_D },
  { X86::VPANDQZrr,            X86::VPANDDZrmb,           TB_BCAST_D },
  { X86::VPORDZ128rr,          X86::VPORQZ128rmb,         TB_BCAST_Q },
  { X86::VPORDZ256rr,          X86::VPORQZ256rmb,         TB_BCAST_Q },
  { X86::VPORDZrr,             X86::VPORQZrmb,            TB_BCAST_Q },
  { X86::VPORQZ128rr,          X86::VPORDZ128rmb,         TB_BCAST_D },
  { X86::VPORQZ256rr,          X86::VPORDZ256rmb,         TB_BCAST_D },
  { X86::VPORQZrr,             X86::VPORDZrmb,            TB_BCAST_D },
  { X86::VPXORDZ128rr,         X86::VPXORQZ128rmb,        TB_BCAST_Q },
  { X86::VPXORDZ256rr,         X86::VPXORQZ256rmb,        TB_BCAST_Q },
  { X86::VPXORDZrr,            X86::VPXORQZrmb,           TB_BCAST_Q },
  { X86::VPXORQZ128rr,         X86::VPXORDZ128rmb,        TB_BCAST_D },
  { X86::VPXORQZ256rr,         X86::VPXORDZ256rmb,        TB_BCAST_D },
  { X86::VPXORQZrr,            X86::VPXORDZrmb,           TB_BCAST_D },
  { X86::VXORPDZ128rr,         X86::VXORPSZ128rmb,        TB_BCAST_SS },
  { X86::VXORPDZ256rr,         X86::VXORPSZ256rmb,        TB_BCAST_SS },
  { X86::VXORPDZrr,            X86::VXORPSZrmb,           TB_BCAST_SS },
  { X86::VXORPSZ128rr,         X86::VXORPDZ128rmb,        TB_BCAST_SD },
  { X86::VXORPSZ256rr,         X86::VXORPDZ256rmb,        TB_BCAST_SD },
  { X86::VXORPSZrr,            X86::VXORPDZrmb,           TB_BCAST_SD },
};

static const X86MemoryFoldTableEntry BroadcastSizeFoldTable3[] = {
  { X86::VPTERNLOGDZ128rri,    X86::VPTERNLOGQZ128rmbi,   TB_BCAST_Q },
  { X86::VPTERNLOGDZ256rri,    X86::VPTERNLOGQZ256rmbi,   TB_BCAST_Q },
  { X86::VPTERNLOGDZrri,       X86::VPTERNLOGQZrmbi,      TB_BCAST_Q },
  { X86::VPTERNLOGQZ128rri,    X86::VPTERNLOGDZ128rmbi,   TB_BCAST_D },
  { X86::VPTERNLOGQZ256rri,    X86::VPTERNLOGDZ256rmbi,   TB_BCAST_D },
  { X86::VPTERNLOGQZrri,       X86::VPTERNLOGDZrmbi,      TB_BCAST_D },
};

static const X86MemoryFoldTableEntry *
lookupFoldTableImpl(ArrayRef<X86MemoryFoldTableEntry> Table, unsigned RegOp) {
#ifndef NDEBUG
  // Make sure the tables are sorted.
  static std::atomic<bool> FoldTablesChecked(false);
  if (!FoldTablesChecked.load(std::memory_order_relaxed)) {
    assert(llvm::is_sorted(MemoryFoldTable2Addr) &&
           std::adjacent_find(std::begin(MemoryFoldTable2Addr),
                              std::end(MemoryFoldTable2Addr)) ==
               std::end(MemoryFoldTable2Addr) &&
           "MemoryFoldTable2Addr is not sorted and unique!");
    assert(llvm::is_sorted(MemoryFoldTable0) &&
           std::adjacent_find(std::begin(MemoryFoldTable0),
                              std::end(MemoryFoldTable0)) ==
               std::end(MemoryFoldTable0) &&
           "MemoryFoldTable0 is not sorted and unique!");
    assert(llvm::is_sorted(MemoryFoldTable1) &&
           std::adjacent_find(std::begin(MemoryFoldTable1),
                              std::end(MemoryFoldTable1)) ==
               std::end(MemoryFoldTable1) &&
           "MemoryFoldTable1 is not sorted and unique!");
    assert(llvm::is_sorted(MemoryFoldTable2) &&
           std::adjacent_find(std::begin(MemoryFoldTable2),
                              std::end(MemoryFoldTable2)) ==
               std::end(MemoryFoldTable2) &&
           "MemoryFoldTable2 is not sorted and unique!");
    assert(llvm::is_sorted(MemoryFoldTable3) &&
           std::adjacent_find(std::begin(MemoryFoldTable3),
                              std::end(MemoryFoldTable3)) ==
               std::end(MemoryFoldTable3) &&
           "MemoryFoldTable3 is not sorted and unique!");
    assert(llvm::is_sorted(MemoryFoldTable4) &&
           std::adjacent_find(std::begin(MemoryFoldTable4),
                              std::end(MemoryFoldTable4)) ==
               std::end(MemoryFoldTable4) &&
           "MemoryFoldTable4 is not sorted and unique!");
    assert(llvm::is_sorted(BroadcastFoldTable2) &&
           std::adjacent_find(std::begin(BroadcastFoldTable2),
                              std::end(BroadcastFoldTable2)) ==
               std::end(BroadcastFoldTable2) &&
           "BroadcastFoldTable2 is not sorted and unique!");
    assert(llvm::is_sorted(BroadcastFoldTable3) &&
           std::adjacent_find(std::begin(BroadcastFoldTable3),
                              std::end(BroadcastFoldTable3)) ==
               std::end(BroadcastFoldTable3) &&
           "BroadcastFoldTable3 is not sorted and unique!");
#if INTEL_CUSTOMIZATION
    assert(std::is_sorted(std::begin(BroadcastFoldTable4),
                          std::end(BroadcastFoldTable4)) &&
           std::adjacent_find(std::begin(BroadcastFoldTable4),
                              std::end(BroadcastFoldTable4)) ==
           std::end(BroadcastFoldTable4) &&
           "BroadcastFoldTable4 is not sorted and unique!");
#endif // INTEL_CUSTOMIZATION
    assert(llvm::is_sorted(BroadcastSizeFoldTable2) &&
           std::adjacent_find(std::begin(BroadcastSizeFoldTable2),
                              std::end(BroadcastSizeFoldTable2)) ==
               std::end(BroadcastSizeFoldTable2) &&
           "BroadcastSizeFoldTable2 is not sorted and unique!");
    assert(llvm::is_sorted(BroadcastSizeFoldTable3) &&
           std::adjacent_find(std::begin(BroadcastSizeFoldTable3),
                              std::end(BroadcastSizeFoldTable3)) ==
               std::end(BroadcastSizeFoldTable3) &&
           "BroadcastSizeFoldTable3 is not sorted and unique!");
    FoldTablesChecked.store(true, std::memory_order_relaxed);
  }
#endif

  const X86MemoryFoldTableEntry *Data = llvm::lower_bound(Table, RegOp);
  if (Data != Table.end() && Data->KeyOp == RegOp &&
      !(Data->Flags & TB_NO_FORWARD))
    return Data;
  return nullptr;
}

const X86MemoryFoldTableEntry *
llvm::lookupTwoAddrFoldTable(unsigned RegOp) {
  return lookupFoldTableImpl(MemoryFoldTable2Addr, RegOp);
}

const X86MemoryFoldTableEntry *
llvm::lookupFoldTable(unsigned RegOp, unsigned OpNum) {
  ArrayRef<X86MemoryFoldTableEntry> FoldTable;
  if (OpNum == 0)
    FoldTable = ArrayRef(MemoryFoldTable0);
  else if (OpNum == 1)
    FoldTable = ArrayRef(MemoryFoldTable1);
  else if (OpNum == 2)
    FoldTable = ArrayRef(MemoryFoldTable2);
  else if (OpNum == 3)
    FoldTable = ArrayRef(MemoryFoldTable3);
  else if (OpNum == 4)
    FoldTable = ArrayRef(MemoryFoldTable4);
  else
    return nullptr;

  return lookupFoldTableImpl(FoldTable, RegOp);
}

#if INTEL_CUSTOMIZATION
const X86MemoryFoldTableEntry *llvm::lookupBroadcastFoldTableByOpNum(unsigned RegOp,
                                                              unsigned OpNum) {
  ArrayRef<X86MemoryFoldTableEntry> FoldTable;
  if (OpNum == 2)
    FoldTable = ArrayRef(BroadcastFoldTable2);
  else if (OpNum == 3)
    FoldTable = ArrayRef(BroadcastFoldTable3);
  else if (OpNum == 4)
    FoldTable = ArrayRef(BroadcastFoldTable4);
  else
    return nullptr;

  return lookupFoldTableImpl(FoldTable, RegOp);
}
#endif // INTEL_CUSTOMIZATION

namespace {

// This class stores the memory unfolding tables. It is instantiated as a
// function scope static variable to lazily init the unfolding table.
struct X86MemUnfoldTable {
  // Stores memory unfolding tables entries sorted by opcode.
  std::vector<X86MemoryFoldTableEntry> Table;

  X86MemUnfoldTable() {
    for (const X86MemoryFoldTableEntry &Entry : MemoryFoldTable2Addr)
      // Index 0, folded load and store, no alignment requirement.
      addTableEntry(Entry, TB_INDEX_0 | TB_FOLDED_LOAD | TB_FOLDED_STORE);

    for (const X86MemoryFoldTableEntry &Entry : MemoryFoldTable0)
      // Index 0, mix of loads and stores.
      addTableEntry(Entry, TB_INDEX_0);

    for (const X86MemoryFoldTableEntry &Entry : MemoryFoldTable1)
      // Index 1, folded load
      addTableEntry(Entry, TB_INDEX_1 | TB_FOLDED_LOAD);

    for (const X86MemoryFoldTableEntry &Entry : MemoryFoldTable2)
      // Index 2, folded load
      addTableEntry(Entry, TB_INDEX_2 | TB_FOLDED_LOAD);

    for (const X86MemoryFoldTableEntry &Entry : MemoryFoldTable3)
      // Index 3, folded load
      addTableEntry(Entry, TB_INDEX_3 | TB_FOLDED_LOAD);

    for (const X86MemoryFoldTableEntry &Entry : MemoryFoldTable4)
      // Index 4, folded load
      addTableEntry(Entry, TB_INDEX_4 | TB_FOLDED_LOAD);

    // Broadcast tables.
    for (const X86MemoryFoldTableEntry &Entry : BroadcastFoldTable2)
      // Index 2, folded broadcast
      addTableEntry(Entry, TB_INDEX_2 | TB_FOLDED_LOAD | TB_FOLDED_BCAST);

    for (const X86MemoryFoldTableEntry &Entry : BroadcastFoldTable3)
      // Index 3, folded broadcast
      addTableEntry(Entry, TB_INDEX_3 | TB_FOLDED_LOAD | TB_FOLDED_BCAST);

#if INTEL_CUSTOMIZATION
    for (const X86MemoryFoldTableEntry &Entry : BroadcastFoldTable4)
      // Index 4, folded broadcast
      addTableEntry(Entry, TB_INDEX_4 | TB_FOLDED_LOAD | TB_FOLDED_BCAST);
#endif // INTEL_CUSTOMIZATION

    // Sort the memory->reg unfold table.
    array_pod_sort(Table.begin(), Table.end());

    // Now that it's sorted, ensure its unique.
    assert(std::adjacent_find(Table.begin(), Table.end()) == Table.end() &&
           "Memory unfolding table is not unique!");
  }

  void addTableEntry(const X86MemoryFoldTableEntry &Entry,
                     uint16_t ExtraFlags) {
    // NOTE: This swaps the KeyOp and DstOp in the table so we can sort it.
    if ((Entry.Flags & TB_NO_REVERSE) == 0)
      Table.push_back({Entry.DstOp, Entry.KeyOp,
                      static_cast<uint16_t>(Entry.Flags | ExtraFlags) });
  }
};
}

const X86MemoryFoldTableEntry *
llvm::lookupUnfoldTable(unsigned MemOp) {
  static X86MemUnfoldTable MemUnfoldTable;
  auto &Table = MemUnfoldTable.Table;
  auto I = llvm::lower_bound(Table, MemOp);
  if (I != Table.end() && I->KeyOp == MemOp)
    return &*I;
  return nullptr;
}

namespace {

// This class stores the memory -> broadcast folding tables. It is instantiated
// as a function scope static variable to lazily init the folding table.
struct X86MemBroadcastFoldTable {
  // Stores memory broadcast folding tables entries sorted by opcode.
  std::vector<X86MemoryFoldTableEntry> Table;

  X86MemBroadcastFoldTable() {
    // Broadcast tables.
    for (const X86MemoryFoldTableEntry &Reg2Bcst : BroadcastFoldTable2) {
      unsigned RegOp = Reg2Bcst.KeyOp;
      unsigned BcstOp = Reg2Bcst.DstOp;
      if (const X86MemoryFoldTableEntry *Reg2Mem = lookupFoldTable(RegOp, 2)) {
        unsigned MemOp = Reg2Mem->DstOp;
        uint16_t Flags = Reg2Mem->Flags | Reg2Bcst.Flags | TB_INDEX_2 |
                         TB_FOLDED_LOAD | TB_FOLDED_BCAST;
        Table.push_back({MemOp, BcstOp, Flags});
      }
    }
    for (const X86MemoryFoldTableEntry &Reg2Bcst : BroadcastSizeFoldTable2) {
      unsigned RegOp = Reg2Bcst.KeyOp;
      unsigned BcstOp = Reg2Bcst.DstOp;
      if (const X86MemoryFoldTableEntry *Reg2Mem = lookupFoldTable(RegOp, 2)) {
        unsigned MemOp = Reg2Mem->DstOp;
        uint16_t Flags = Reg2Mem->Flags | Reg2Bcst.Flags | TB_INDEX_2 |
                         TB_FOLDED_LOAD | TB_FOLDED_BCAST;
        Table.push_back({MemOp, BcstOp, Flags});
      }
    }

    for (const X86MemoryFoldTableEntry &Reg2Bcst : BroadcastFoldTable3) {
      unsigned RegOp = Reg2Bcst.KeyOp;
      unsigned BcstOp = Reg2Bcst.DstOp;
      if (const X86MemoryFoldTableEntry *Reg2Mem = lookupFoldTable(RegOp, 3)) {
        unsigned MemOp = Reg2Mem->DstOp;
        uint16_t Flags = Reg2Mem->Flags | Reg2Bcst.Flags | TB_INDEX_3 |
                         TB_FOLDED_LOAD | TB_FOLDED_BCAST;
        Table.push_back({MemOp, BcstOp, Flags});
      }
    }
    for (const X86MemoryFoldTableEntry &Reg2Bcst : BroadcastSizeFoldTable3) {
      unsigned RegOp = Reg2Bcst.KeyOp;
      unsigned BcstOp = Reg2Bcst.DstOp;
      if (const X86MemoryFoldTableEntry *Reg2Mem = lookupFoldTable(RegOp, 3)) {
        unsigned MemOp = Reg2Mem->DstOp;
        uint16_t Flags = Reg2Mem->Flags | Reg2Bcst.Flags | TB_INDEX_3 |
                         TB_FOLDED_LOAD | TB_FOLDED_BCAST;
        Table.push_back({MemOp, BcstOp, Flags});
      }
    }

    // Sort the memory->broadcast fold table.
    array_pod_sort(Table.begin(), Table.end());
  }
};
} // namespace

static bool matchBroadcastSize(const X86MemoryFoldTableEntry &Entry,
                               unsigned BroadcastBits) {
  switch (Entry.Flags & TB_BCAST_MASK) {
  case TB_BCAST_SD:
  case TB_BCAST_Q:
    return BroadcastBits == 64;
  case TB_BCAST_SS:
  case TB_BCAST_D:
    return BroadcastBits == 32;
  }
  return false;
}

const X86MemoryFoldTableEntry *
llvm::lookupBroadcastFoldTable(unsigned MemOp, unsigned BroadcastBits) {
  static X86MemBroadcastFoldTable MemBroadcastFoldTable;
  auto &Table = MemBroadcastFoldTable.Table;
  for (auto I = llvm::lower_bound(Table, MemOp);
       I != Table.end() && I->KeyOp == MemOp; ++I) {
    if (matchBroadcastSize(*I, BroadcastBits))
      return &*I;
  }
  return nullptr;
}
