# REQUIRES: system-linux

# RUN: cp -f %S/Inputs/empty %t.ll && %intel_update_markup %t.ll --ref %S/Inputs/empty 2>&1 >%t.log
# RUN: diff -u %S/Inputs/empty %t.log
#
# RUN: cp -f %S/Inputs/x86-basic-exp.ll %t.ll && %intel_update_markup %t.ll --log --comment --ref %S/Inputs/x86-basic-ref.ll >%t.log
# RUN: FileCheck < %t.log %s --check-prefixes=LOG,COMMENT
#
# RUN: cp -f %S/Inputs/run-line-continue.ll %t.ll && %intel_update_markup %t.ll --log --ref %S/Inputs/empty >%t.log
# RUN: FileCheck < %t.log %s --check-prefixes=LOG,CONT
#
# RUN: cp -f %S/Inputs/run-check-line.mir %t.ll && %intel_update_markup %t.ll --log --ref %S/Inputs/empty >%t.log
# RUN: FileCheck < %t.log %s --check-prefixes=LOG,RUN_CHECK
#
# RUN: cp -f %S/Inputs/number %t.ll && cp -f %S/Inputs/number %t.mir && %intel_update_markup --log %t.ll %t.mir --ref %S/Inputs/empty >%t.log
# RUN: FileCheck < %t.log %s --check-prefixes=PARALLEL,PROCESS
#
# RUN: cp -f %S/Inputs/number %t.ll && cp -f %S/Inputs/number %t.mir && %intel_update_markup --log -j 3 %t.ll %t.mir --ref %S/Inputs/empty >%t.log
# RUN: FileCheck < %t.log %s --check-prefixes=PARALLEL,PROCESS
#
# RUN: %intel_update_markup --log -j 1 %t.ll %t.mir --ref %S/Inputs/empty >%t.log
# RUN: FileCheck < %t.log %s --check-prefixes=SERIAL,PROCESS

# LOG: Running 1 job(s) in parallel ...
# LOG: Processing file {{.*}} ...
# LOG: Dropping markup and note ...
# LOG-NEXT: SED script: {{.*}}

# CONT: Found RUN lines that end with \: [1]

# RUN_CHECK: Found RUN lines: [1, 2, 4]
# RUN_CHECK-NEXT: Found FileCheck commands: ['FileCheck --check-prefixes=COMMON,O2 %s', 'FileCheck %s', 'FileCheck --check-prefixes=COMMON,O0 %s']
# RUN_CHECK-NEXT: Found CHECK prefixes: ['COMMON', 'O2']
# RUN_CHECK-NEXT: Found CHECK prefixes: ['CHECK']
# RUN_CHECK-NEXT: Found CHECK prefixes: ['COMMON', 'O0']
# RUN_CHECK-NEXT: Found CHECK lines: [7, 8, 9, 10]

# LOG: Adding markup ...
# LOG-NEXT: SED script: {{.*}}

# COMMENT: Adding note ...
# COMMENT-NEXT: SED script: {{.*}}

# PARALLEL: Running 2 job(s) in parallel ...
# SERIAL: Running 1 job(s) in parallel ...
# PROCESS: Processing file {{.*}} ...
# PROCESS: Processing file {{.*}} ...
