; NOTE: Assertions have been autogenerated by utils/update_test_checks.py

; RUN: opt -opaque-pointers -S -inline -verify %s | FileCheck %s
; RUN: opt -opaque-pointers -S -passes='inline,verify' %s | FileCheck %s

; CMPLRLLVM-33396: The vector-of-pointers was not allowed by CaptureTracking.
; We would like to inline foo into bar, and keep the noalias attribute in
; the metadata.

define weak_odr void @bar() {
; CHECK-LABEL: @bar(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    call void @llvm.experimental.noalias.scope.decl(metadata [[META0:![0-9]+]])
; CHECK-NEXT:    [[X_I:%.*]] = call <32 x i32> @baz(<32 x ptr> zeroinitializer), !noalias [[META0]]
; CHECK-NEXT:    ret void
;
entry:
  call fastcc void @foo(<32 x ptr> zeroinitializer)
  ret void
}

define internal fastcc void @foo(<32 x ptr> noalias %this) {
entry:
  %i = icmp ne <32 x i64> zeroinitializer, zeroinitializer
  %i1 = select <32 x i1> zeroinitializer, <32 x ptr> %this, <32 x ptr> zeroinitializer
  %x = call <32 x i32> @baz(<32 x ptr> zeroinitializer)
  ret void
}

declare <32 x i32> @baz(<32 x ptr>)
