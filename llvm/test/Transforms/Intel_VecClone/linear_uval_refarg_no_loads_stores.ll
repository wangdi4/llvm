; NOTE: Assertions have been autogenerated by utils/intel_update_vplan_checks.py UTC_ARGS: --version 2
; RUN: opt -passes="vec-clone" -S < %s | FileCheck %s

; Check to see that the value of the val reference arg is updated with stride
; before the call to baz.

define dso_local void @_Z3fooRl(ptr noundef nonnull align 8 dereferenceable(8) %l1) local_unnamed_addr #0 {
;
; CHECK:      [[STRIDE_MUL0:%.*]] = mul i64 1, [[PHI_CAST0:%.*]]
; CHECK-NEXT: [[STRIDE_ADD0:%.*]] = add i64 [[LOAD_LOAD_ALLOCA_L1_SCALAR0:%.*]], [[STRIDE_MUL0]]
; CHECK-NEXT: store i64 [[STRIDE_ADD0]], ptr [[LOAD_ALLOCA_L1_SCALAR0:%.*]], align 4
; CHECK-NEXT: tail call void @_Z3bazRl(ptr noundef nonnull align 8 dereferenceable(8) [[LOAD_ALLOCA_L1_SCALAR0]])
;
entry:
  tail call void @llvm.intel.directive.elementsize(ptr nonnull %l1, i64 8)
  tail call void @_Z3bazRl(ptr noundef nonnull align 8 dereferenceable(8) %l1)
  ret void
}

declare void @llvm.intel.directive.elementsize(ptr, i64 immarg)
declare void @_Z3bazRl(ptr noundef nonnull align 8 dereferenceable(8))

attributes #0 = { "vector-variants"="_ZGVbN4U__Z3fooRl" }
