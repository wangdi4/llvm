; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt %s -S -vplan-vec | FileCheck %s

target triple = "x86_64-unknown-linux-gnu"

%"QNCA_a0$i32*$rank2$" = type { i32*, i64, i64, i64, i64, i64, [2 x { i64, i64, i64 }] }

define i32 @sum_() {
; CHECK-LABEL: @sum_(
; CHECK-NEXT:  DIR.OMP.SIMD.144:
; CHECK-NEXT:    [[DOTVEC:%.*]] = alloca [2 x %"QNCA_a0$i32*$rank2$"], align 8
; CHECK-NEXT:    [[DOTVEC_BC:%.*]] = bitcast [2 x %"QNCA_a0$i32*$rank2$"]* [[DOTVEC]] to %"QNCA_a0$i32*$rank2$"*
; CHECK-NEXT:    [[DOTVEC_BASE_ADDR:%.*]] = getelementptr %"QNCA_a0$i32*$rank2$", %"QNCA_a0$i32*$rank2$"* [[DOTVEC_BC]], <2 x i32> <i32 0, i32 1>
; CHECK-NEXT:    [[DOTVEC_BASE_ADDR_EXTRACT_1_:%.*]] = extractelement <2 x %"QNCA_a0$i32*$rank2$"*> [[DOTVEC_BASE_ADDR]], i32 1
; CHECK-NEXT:    br label [[VPLANNEDBB:%.*]]
; CHECK:       VPlannedBB:
; CHECK-NEXT:    br label [[VPLANNEDBB1:%.*]]
; CHECK:       VPlannedBB1:
; CHECK-NEXT:    br i1 true, label [[SCALAR_PH:%.*]], label [[VECTOR_PH:%.*]]
; CHECK:       vector.ph:
; CHECK-NEXT:    br label [[VECTOR_BODY:%.*]]
; CHECK:       vector.body:
; CHECK-NEXT:    [[UNI_PHI:%.*]] = phi i64 [ 0, [[VECTOR_PH]] ], [ [[TMP2:%.*]], [[VPLANNEDBB4:%.*]] ]
; CHECK-NEXT:    [[UNI_PHI3:%.*]] = phi i64 [ [[TMP1:%.*]], [[VPLANNEDBB4]] ], [ 1, [[VECTOR_PH]] ]
; CHECK-NEXT:    [[VEC_PHI:%.*]] = phi <2 x i64> [ [[TMP0:%.*]], [[VPLANNEDBB4]] ], [ <i64 1, i64 2>, [[VECTOR_PH]] ]
; CHECK-NEXT:    br label [[VPLANNEDBB4]]
; CHECK:       VPlannedBB4:
; CHECK-NEXT:    [[TMP0]] = add nuw <2 x i64> [[VEC_PHI]], <i64 2, i64 2>
; CHECK-NEXT:    [[TMP1]] = add nuw i64 [[UNI_PHI3]], 2
; CHECK-NEXT:    [[TMP2]] = add i64 [[UNI_PHI]], 2
; CHECK-NEXT:    [[TMP3:%.*]] = icmp uge i64 [[TMP2]], 0
; CHECK-NEXT:    br i1 [[TMP3]], label [[VPLANNEDBB5:%.*]], label [[VECTOR_BODY]], !llvm.loop [[LOOP0:![0-9]+]]
; CHECK:       VPlannedBB5:
; CHECK-NEXT:    [[TMP4:%.*]] = bitcast %"QNCA_a0$i32*$rank2$"* [[DOTVEC_BASE_ADDR_EXTRACT_1_]] to i8*
; CHECK-NEXT:    call void @llvm.memcpy.p0i8.p0i8.i64(i8* align 8 undef, i8* align 8 [[TMP4]], i64 96, i1 false)
; CHECK-NEXT:    br label [[MIDDLE_BLOCK:%.*]]
;
DIR.OMP.SIMD.144:
  %0 = call token @llvm.directive.region.entry() [ "DIR.OMP.SIMD"(), "QUAL.OMP.LASTPRIVATE:F90_DV"(%"QNCA_a0$i32*$rank2$"* undef) ]
  br label %loop_test12.preheader

loop_test12.preheader:
  %"$loop_ctr1.037" = phi i64 [ %add.6, %loop_body ], [ 1, %DIR.OMP.SIMD.144 ]
  br label %loop_body

loop_body:
  %add.6 = add nuw i64 %"$loop_ctr1.037", 1
  %exitcond40.not = icmp eq i64 %"$loop_ctr1.037", undef
  br i1 %exitcond40.not, label %loop_exit18.loopexit, label %loop_test12.preheader

loop_exit18.loopexit:
  call void @llvm.directive.region.exit(token %0) [ "DIR.OMP.END.SIMD"() ]
  ret i32 undef
}

declare token @llvm.directive.region.entry()
declare void @llvm.directive.region.exit(token)
