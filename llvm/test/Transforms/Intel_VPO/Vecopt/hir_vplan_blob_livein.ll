; NOTE: Assertions have been autogenerated by utils/intel_update_vplan_checks.py
; RUN: opt -passes="hir-ssa-deconstruction,hir-opt-predicate,hir-temp-cleanup,hir-last-value-computation,hir-vec-dir-insert,hir-vplan-vec,print<hir>" -disable-output %s 2>&1 | FileCheck %s

target datalayout = "e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128"
target triple = "x86_64-unknown-linux-gnu"

define double @sum_pairs_(i64 %"sum_pairs_0_$JHI_fetch.9.i.i", i1 %rel.3.i.i) #0 {
; CHECK-LABEL:  Function: sum_pairs_
; CHECK-EMPTY:
; CHECK-NEXT:  BEGIN REGION { modified }
; CHECK-NEXT:        if ([[REL_3_I_I0:%.*]] == 0)
; ...
; CHECK:             else
; CHECK-NEXT:        {
; ...
; CHECK:                [[RED_INIT_INSERT0:%.*]] = insertelement [[RED_INIT0:%.*]],  %"sum_pairs_0_$OFF.0.i.i",  0
; CHECK-NEXT:           [[PHI_TEMP270:%.*]] = [[RED_INIT_INSERT0]]
; CHECK-NEXT:           [[LOOP_UB290:%.*]] = [[VEC_TC260:%.*]]  -  1
;
; CHECK:                + DO i1 = 0, [[LOOP_UB290]], 8   <DO_LOOP> <auto-vectorized> <nounroll> <novectorize>
; CHECK-NEXT:           |   [[DOTVEC300:%.*]] = [[PHI_TEMP270]]  +  1
; CHECK-NEXT:           |   [[DOTVEC310:%.*]] = [[DOTVEC300]]  +  0
; CHECK-NEXT:           |   [[PHI_TEMP270]] = [[DOTVEC310]]
; CHECK-NEXT:           + END LOOP
;
; CHECK:                %"sum_pairs_0_$OFF.0.i.i" = @llvm.vector.reduce.add.v8i64([[DOTVEC310]])
; CHECK-NEXT:           [[IND_FINAL330:%.*]] = 0  +  [[VEC_TC260]]
; CHECK-NEXT:           [[DOTVEC340:%.*]] = %"sum_pairs_0_$JHI_fetch.9.i.i" + 1 == [[VEC_TC260]]
; CHECK-NEXT:           [[PHI_TEMP200:%.*]] = [[IND_FINAL330]]
; CHECK-NEXT:           [[PHI_TEMP220:%.*]] = %"sum_pairs_0_$OFF.0.i.i"
; CHECK-NEXT:           [[PHI_TEMP370:%.*]] = [[IND_FINAL330]]
; CHECK-NEXT:           [[PHI_TEMP390:%.*]] = %"sum_pairs_0_$OFF.0.i.i"
; CHECK-NEXT:           [[EXTRACT_0_410:%.*]] = extractelement [[DOTVEC340]],  0
; CHECK-NEXT:           if ([[EXTRACT_0_410]] == 1)
; CHECK-NEXT:           {
; CHECK-NEXT:              goto final.merge.122
; CHECK-NEXT:           }
; CHECK-NEXT:           [[MERGE_BLK1:.*]].92:
; CHECK-NEXT:           [[LB_TMP160:%.*]] = [[PHI_TEMP200]]
; CHECK-NEXT:           %"sum_pairs_0_$OFF.0.i.i" = [[PHI_TEMP220]]
;
; CHECK:                + DO i1 = [[LB_TMP160]], %"sum_pairs_0_$JHI_fetch.9.i.i", 1   <DO_LOOP>  <MAX_TC_EST = 7>  <LEGAL_MAX_TC = 7> <vector-remainder> <nounroll> <novectorize> <max_trip_count = 7>
; CHECK-NEXT:           |   %"sum_pairs_0_$OFF.0.i.i" = %"sum_pairs_0_$OFF.0.i.i" + 1  +  0
; CHECK-NEXT:           + END LOOP
;
; CHECK:                [[PHI_TEMP370]] = %"sum_pairs_0_$JHI_fetch.9.i.i"
; CHECK-NEXT:           [[PHI_TEMP390]] = %"sum_pairs_0_$OFF.0.i.i"
; CHECK-NEXT:           final.merge.122:
; CHECK-NEXT:           [[ADD_4_I_I2_LCSSA50:.*]] = 0.000000e+00
; CHECK-NEXT:        }
; CHECK-NEXT:  END REGION
;
alloca_0:
  br label %bb5.i.i

bb5.i.i:                                          ; preds = %bb10.i.i, %alloca_0
  %"sum_pairs_0_$OFF.0.i.i" = phi i64 [ %sub.4.i.i, %bb10.i.i ], [ 0, %alloca_0 ]
  %"sum_pairs_0_$J.0.i.i" = phi i64 [ %add.10.i.i, %bb10.i.i ], [ 0, %alloca_0 ]
  br i1 %rel.3.i.i, label %bb10.i.i, label %bb_new56_then.i.i

bb_new56_then.i.i:                                ; preds = %bb5.i.i
  %"sum_pairs_0_$PAIR[].i.i" = call double* @llvm.intel.subscript.p0f64.i64.i64.p0f64.i64(i8 0, i64 0, i64 0, double* elementtype(double) null, i64 %"sum_pairs_0_$OFF.0.i.i")
  %"sum_pairs_0_$PAIR[]_fetch.30.i.i" = load double, double* %"sum_pairs_0_$PAIR[].i.i", align 1
  br label %bb10.i.i

bb10.i.i:                                         ; preds = %bb_new56_then.i.i, %bb5.i.i
  %add.4.i.i2.lcssa5 = phi double [ 0.000000e+00, %bb5.i.i ], [ 0.000000e+00, %bb_new56_then.i.i ]
  %"sum_pairs_0_$OFF.2.i.i" = phi i64 [ %"sum_pairs_0_$OFF.0.i.i", %bb5.i.i ], [ 0, %bb_new56_then.i.i ]
  %add.9.neg.i.i = add i64 1, %"sum_pairs_0_$OFF.2.i.i"
  %sub.4.i.i = add i64 %add.9.neg.i.i, 0
  %add.10.i.i = add nsw i64 %"sum_pairs_0_$J.0.i.i", 1
  %exitcond7 = icmp eq i64 %"sum_pairs_0_$J.0.i.i", %"sum_pairs_0_$JHI_fetch.9.i.i"
  br i1 %exitcond7, label %sum_pairs_0_.t0p.t0p.t0p.t0p.t0p.t1p.t0p.t1p.t0p.exit.loopexit, label %bb5.i.i

sum_pairs_0_.t0p.t0p.t0p.t0p.t0p.t1p.t0p.t1p.t0p.exit.loopexit: ; preds = %bb10.i.i
  %add.4.i.i2.lcssa5.lcssa = phi double [ %add.4.i.i2.lcssa5, %bb10.i.i ]
  ret double 0.000000e+00
}

; Function Attrs: nounwind readnone speculatable
declare double* @llvm.intel.subscript.p0f64.i64.i64.p0f64.i64(i8, i64, i64, double*, i64) #1

attributes #0 = { "target-cpu"="skylake-avx512" }
attributes #1 = { nounwind readnone speculatable }
