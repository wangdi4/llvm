; NOTE: Assertions have been autogenerated by utils/intel_update_vplan_checks.py
; RUN: opt -enable-new-pm=0 -hir-ssa-deconstruction -analyze -hir-parvec-analysis -debug-only=parvec-analysis < %s 2>&1 | FileCheck %s
; RUN: opt -passes='hir-ssa-deconstruction,print<hir-parvec-analysis>' -debug-only=parvec-analysis -disable-output < %s 2>&1 | FileCheck %s

; Check that vectorization is blocked due to dependence between %dn array references in different if paths.
; Function: main
;
; <0>          BEGIN REGION { }
; <26>               + DO i1 = 0, 76, 1   <DO_LOOP>
; <4>                |   if (-1 * i1 + 67 == 0)
; <4>                |   {
; <9>                |      (%dn)[0][i1 + 3] = 0;
; <4>                |   }
; <4>                |   else
; <4>                |   {
; <14>               |      %2 = (%dn)[0][i1 + 2];
; <16>               |      (%dn)[0][i1 + 2] = %2 + -1;
; <4>                |   }
; <26>               + END LOOP
; <0>          END REGION

target datalayout = "e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128"
target triple = "x86_64-unknown-linux-gnu"

; Function Attrs: nofree nounwind uwtable
define dso_local i32 @main() {
; CHECK-LABEL:  Idiom List
; CHECK-NEXT:    No idioms detected.
; CHECK-NEXT:  9:14 ([[DN0:%.*]])[0][i1 + 3] --> ([[DN0]])[0][i1 + 2] FLOW (<) (1)
; CHECK-NEXT:    DV is not refinable - unsafe to vectorize
; CHECK-NEXT:  9:16 ([[DN0]])[0][i1 + 3] --> ([[DN0]])[0][i1 + 2] OUTPUT (<) (1)
; CHECK-NEXT:    DV is not refinable - unsafe to vectorize

entry:
  %dn = alloca [100 x i32], align 16
  %0 = bitcast [100 x i32]* %dn to i8*
  br label %for.body

for.body:                                         ; preds = %for.inc, %entry
  %indvars.iv = phi i64 [ 3, %entry ], [ %indvars.iv.next, %for.inc ]
  %nc5.028 = phi i32 [ 68, %entry ], [ %dec, %for.inc ]
  %dec = add nsw i32 %nc5.028, -1
  %tobool.not = icmp eq i32 %dec, 0
  br i1 %tobool.not, label %if.else, label %if.then

if.then:                                          ; preds = %for.body
  %1 = add nsw i64 %indvars.iv, -1
  %arrayidx1 = getelementptr inbounds [100 x i32], [100 x i32]* %dn, i64 0, i64 %1
  %2 = load i32, i32* %arrayidx1, align 4
  %sub2 = add i32 %2, -1
  store i32 %sub2, i32* %arrayidx1, align 4
  br label %for.inc

if.else:                                          ; preds = %for.body
  %arrayidx4 = getelementptr inbounds [100 x i32], [100 x i32]* %dn, i64 0, i64 %indvars.iv
  store i32 0, i32* %arrayidx4, align 4
  br label %for.inc

for.inc:                                          ; preds = %if.else, %if.then
  %indvars.iv.next = add nuw nsw i64 %indvars.iv, 1
  %exitcond.not = icmp eq i64 %indvars.iv.next, 80
  br i1 %exitcond.not, label %checkSum.exit, label %for.body

checkSum.exit:                                    ; preds = %for.body.i
  ret i32 0
}
