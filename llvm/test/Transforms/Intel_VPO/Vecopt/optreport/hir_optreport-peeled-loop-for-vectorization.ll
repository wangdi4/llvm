; NOTE: Assertions have been autogenerated by utils/intel_update_vplan_checks.py
; RUN: opt  -enable-new-pm=0 -hir-ssa-deconstruction -hir-temp-cleanup -hir-last-value-computation -hir-vec-dir-insert -hir-vplan-vec -disable-output -vplan-force-vf=4 -intel-loop-optreport=high -hir-optreport-emitter < %s 2>&1 | FileCheck %s
; RUN: opt -passes="hir-ssa-deconstruction,hir-temp-cleanup,hir-last-value-computation,hir-vec-dir-insert,hir-vplan-vec,hir-optreport-emitter" -disable-output -vplan-force-vf=4 -intel-loop-optreport=high < %s 2>&1 | FileCheck %s

; HIR before VPlan-
;  BEGIN REGION { modified }
;        + DO i1 = 0, %n + -1, 1   <DO_MULTI_EXIT_LOOP>
;        |   if ((%t4)[i1] == &((%t1)[0]))
;        |   {
;        |      %gep = &((%t4)[i1]);
;        |      goto found;
;        |   }
;        + END LOOP
;  END REGION

target datalayout = "e-m:e-i64:64-f80:128-n8:16:32:64-S128"
target triple = "x86_64-unknown-linux-gnu"

%struct2 = type <{ i32, [4 x i8] }>

; Function Attrs: uwtable
define %struct2** @foo(%struct2** %t4, %struct2* %t1, i64 %n) {
; CHECK-LABEL:  Report from: HIR Loop optimizations framework for : foo
; CHECK-EMPTY:
; CHECK-NEXT:  LOOP BEGIN
; CHECK-NEXT:  <Peeled loop for vectorization>
; CHECK-NEXT:  LOOP END
; CHECK:  LOOP BEGIN
; CHECK:  <Remainder loop for vectorization>
; CHECK-NEXT:      remark #15441: remainder loop was not vectorized:
; CHECK-NEXT:  LOOP END
; CHECK-NEXT:  =================================================================
;
entry:
  br label %header

header:
  %iv = phi i64 [0, %entry], [%iv.next, %latch]
  %gep = getelementptr %struct2*, %struct2 **%t4, i64 %iv
  %ptr = load %struct2 *, %struct2** %gep
  %cmp.found = icmp eq %struct2 *%ptr, %t1
  br i1 %cmp.found, label %found, label %latch

latch:
  %iv.next = add i64 %iv, 1
  %exitcond = icmp eq i64 %iv.next, %n
  br i1 %exitcond, label %loop.exit, label %header

loop.exit:
  br label %exit

found:
  %lcssa = phi %struct2 ** [ %gep , %header ]
  br label %exit

exit:
  %val = phi %struct2 ** [ %lcssa, %found ], [ zeroinitializer, %loop.exit ]
  ret %struct2 ** %val
}
