; NOTE: Assertions have been autogenerated by utils/intel_update_vplan_checks.py
; RUN: opt < %s -hir-ssa-deconstruction -hir-framework -hir-vec-dir-insert -hir-vplan-vec -disable-output -print-after=hir-vplan-vec 2>&1 | FileCheck %s
; RUN: opt < %s -passes='hir-ssa-deconstruction,hir-vec-dir-insert,hir-vplan-vec,print<hir>' -disable-output  2>&1 | FileCheck %s
target datalayout = "e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128"
target triple = "x86_64-unknown-linux-gnu"

; Ensure we don't crash in search idiom recognition.
define i64 @foo(i1 %c) {
; CHECK:       Function: foo
; CHECK-EMPTY:
; CHECK-NEXT:  BEGIN REGION { }
; CHECK-NEXT:        + DO i1 = 0, 5, 1   <DO_MULTI_EXIT_LOOP>
; CHECK-NEXT:        |   if (%c != 0)
; CHECK-NEXT:        |   {
; CHECK-NEXT:        |      goto early.exit
; CHECK-NEXT:        |   }
; CHECK-NEXT:        + END LOOP
; CHECK-NEXT:  END REGION
;
entry:
  br label %header

header:
  %iv = phi i64 [0, %entry], [%iv.next, %latch]
  br i1 %c, label %early.exit, label %latch

latch:
  %iv.next = add nsw nuw i64 %iv, 1
  %cmp = icmp eq i64 %iv.next, 6
  br i1 %cmp, label %exit, label %header

early.exit:
  br label %ret.block

exit:
  br label %ret.block

ret.block:
  %p = phi i64 [1, %early.exit], [2, %exit]
  ret i64 %p
}
