; NOTE: Assertions have been autogenerated by utils/intel_update_vplan_checks.py UTC_ARGS: --version 3
; RUN: opt %s -disable-output -print-after=hir-vplan-vec -passes="hir-ssa-deconstruction,hir-temp-cleanup,hir-loop-collapse,hir-vec-dir-insert,hir-vplan-vec" -mtriple=x86_64-unknown-linux-gnu 2>&1 | FileCheck %s

define void @foo() #0 {
;
; Reduced cvf_unittestsF/me_intrinsics_ut6 test which caused the vectorizer crash.
; Verify that the loop successfully vectorized.
;
; CHECK: BEGIN REGION { modified }
; CHECK:       [[RED_INIT_INSERT0:%.*]] = insertelement [[RED_INIT0:%.*]],  %"var$73.1805",  0
; CHECK:       [[PHI_TEMP0:%.*]] = [[RED_INIT_INSERT0]]
; CHECK:       [[DOTVEC20:%.*]] = <i64 0, i64 1, i64 2, i64 3, i64 4, i64 5, i64 6, i64 7, i64 8, i64 9, i64 10, i64 11, i64 12, i64 13, i64 14, i64 15> <u [[DOTVEC0:%.*]]
; CHECK:       [[DOTVEC40:%.*]] = (<16 x i32>*)([[NSBGEPCOPY30:%.*]])[1][0], Mask = @{[[DOTVEC20]]}
; CHECK:       [[DOTVEC50:%.*]] = [[DOTVEC40]]  &  [[PHI_TEMP0]]
; CHECK:       [[SELECT0:%.*]] = ([[DOTVEC20]] == <i1 true, i1 true, i1 true, i1 true, i1 true, i1 true, i1 true, i1 true, i1 true, i1 true, i1 true, i1 true, i1 true, i1 true, i1 true, i1 true>) ? [[DOTVEC50]] : [[PHI_TEMP0]]
; CHECK:       %"var$73.1805" = @llvm.vector.reduce.and.v16i32([[SELECT0]])
; CHECK: END REGION
;
alloca_0:
  br label %loop_test291.preheader

loop_body292:                                     ; preds = %loop_test291.preheader, %loop_body292
  %"$loop_ctr282.0802" = phi i64 [ 1, %loop_test291.preheader ], [ %add.52, %loop_body292 ]
  %"temp_array287[][]294" = call ptr @llvm.intel.subscript.p0.i64.i64.p0.i64(i8 0, i64 1, i64 4, ptr elementtype(i32) %"temp_array287[]293", i64 %"$loop_ctr282.0802")
  %"temp_array287[][]_fetch.195" = load i32, ptr %"temp_array287[][]294", align 4
  %and.16 = and i32 %"temp_array287[][]_fetch.195", %"var$73.1805"
  %add.52 = add i64 %"$loop_ctr282.0802", 1
  %exitcond871.not = icmp eq i64 %add.52, 4
  br i1 %exitcond871.not, label %loop_exit293, label %loop_body292

loop_exit293:                                     ; preds = %loop_body292
  %add.53 = add i64 %"$loop_ctr283.0804", 1
  %exitcond872.not = icmp eq i64 %add.53, 6
  br i1 %exitcond872.not, label %loop_exit297, label %loop_test291.preheader

loop_test291.preheader:                           ; preds = %loop_exit293, %alloca_0
  %"var$73.1805" = phi i32 [ %and.16, %loop_exit293 ], [ 0, %alloca_0 ]
  %"$loop_ctr283.0804" = phi i64 [ %add.53, %loop_exit293 ], [ 1, %alloca_0 ]
  %"temp_array287[]293" = call ptr @llvm.intel.subscript.p0.i64.i64.p0.i64(i8 1, i64 0, i64 12, ptr elementtype(i32) null, i64 %"$loop_ctr283.0804")
  br label %loop_body292

loop_exit297:                                     ; preds = %loop_exit293
  %and.16.lcssa.lcssa = phi i32 [ %and.16, %loop_exit293 ]
  ret void
}

declare ptr @llvm.intel.subscript.p0.i64.i64.p0.i64(i8, i64, i64, ptr, i64)

attributes #0 = { "target-cpu"="skylake-avx512" }
