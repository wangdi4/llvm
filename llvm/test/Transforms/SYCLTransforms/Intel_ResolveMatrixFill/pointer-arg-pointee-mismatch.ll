; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -passes=sycl-kernel-resolve-matrix-fill -S %s | FileCheck %s -check-prefixes=CHECK,NONOPAQUE
; RUN: opt -opaque-pointers -passes=sycl-kernel-resolve-matrix-fill -S %s | FileCheck %s -check-prefixes=CHECK,OPAQUE
; RUN: opt -passes=sycl-kernel-resolve-matrix-fill -enable-debugify -S %s 2>&1 | FileCheck %s -check-prefix=DEBUGIFY
; RUN: opt -opaque-pointers -passes=sycl-kernel-resolve-matrix-fill -enable-debugify -S %s 2>&1 | FileCheck %s -check-prefix=DEBUGIFY

%"class.sycl::_V1::ext::oneapi::bfloat16" = type { i16 }

define void @test() {
; CHECK:             [[AGG_TMP_I_I:%.*]] = alloca %"class.sycl::_V1::ext::oneapi::bfloat16", align 2
; NONOPAQUE-NEXT:    [[TMP0:%.*]] = bitcast %"class.sycl::_V1::ext::oneapi::bfloat16"* [[AGG_TMP_I_I]] to i16*
; NONOPAQUE-NEXT:    [[LOADED_FILL_DATA:%.*]] = load i16, i16* [[TMP0]], align 2
; OPAQUE-NEXT:       [[LOADED_FILL_DATA:%.*]] = load i16, ptr [[AGG_TMP_I_I]], align 2
entry:
  %agg.tmp.i.i = alloca %"class.sycl::_V1::ext::oneapi::bfloat16", align 2
  %call.i = call <128 x i16> @"llvm.experimental.matrix.fill.v128i16.p0s_class.sycl::_V1::ext::oneapi::bfloat16s"(%"class.sycl::_V1::ext::oneapi::bfloat16"* nonnull %agg.tmp.i.i, i32 8, i32 16, metadata !"matrix.rowmajor", metadata !"scope.subgroup", metadata !"matrix.use.a")
  call void @foo(<128 x i16> %call.i)
  ret void
}

declare <128 x i16> @"llvm.experimental.matrix.fill.v128i16.p0s_class.sycl::_V1::ext::oneapi::bfloat16s"(%"class.sycl::_V1::ext::oneapi::bfloat16"*, i32, i32, metadata, metadata, metadata)
declare void @foo(<128 x i16>)

; DEBUGIFY-NOT: WARNING
; DEBUGIFY: PASS
