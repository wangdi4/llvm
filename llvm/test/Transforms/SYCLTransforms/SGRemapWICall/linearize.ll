; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt --passes=sycl-kernel-sg-remap-wi-call -sycl-sg-construction-mode=linear -S %s | FileCheck %s
; RUN: opt --passes=sycl-kernel-sg-remap-wi-call -sycl-sg-construction-mode=linear -enable-debugify -disable-output -S %s 2>&1 | FileCheck -check-prefix=DEBUGIFY %s

define void @gid() {
; CHECK-LABEL: @gid(
; CHECK-SAME: !sg_construction_mode ![[#MD:]]
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[LINEARIZED_LID_GID0:%.*]] = call i64 @_Z12get_local_idj(i32 0)
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_LID_GID0:%.*]] = call i64 @user._Z14get_local_sizej(i32 0)
; CHECK-NEXT:    [[RECOVERED_LID_GID0:%.*]] = urem i64 [[LINEARIZED_LID_GID0]], [[CURRENT_DIM_SIZE_LID_GID0]]
; CHECK-NEXT:    [[LINEARIZED_GROUPID_GID0:%.*]] = call i64 @_Z12get_group_idj(i32 0)
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_GROUPID_GID0:%.*]] = call i64 @user._Z14get_num_groupsj(i32 0)
; CHECK-NEXT:    [[RECOVERED_GROUPID_GID0:%.*]] = urem i64 [[LINEARIZED_GROUPID_GID0]], [[CURRENT_DIM_SIZE_GROUPID_GID0]]
; CHECK-NEXT:    [[LSIZE_GID0:%.*]] = call i64 @user._Z14get_local_sizej(i32 0)
; CHECK-NEXT:    [[GROUPOFFSET_GID0:%.*]] = mul nuw i64 [[RECOVERED_GROUPID_GID0]], [[LSIZE_GID0]]
; CHECK-NEXT:    [[TRANSLATED_GID0:%.*]] = add nuw i64 [[RECOVERED_LID_GID0]], [[GROUPOFFSET_GID0]]
; CHECK-NEXT:    [[LINEARIZED_LID_GID1:%.*]] = call i64 @_Z12get_local_idj(i32 0)
; CHECK-NEXT:    [[SIZE_LID_GID1:%.*]] = call i64 @user._Z14get_local_sizej(i32 0)
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_LID_GID1:%.*]] = call i64 @user._Z14get_local_sizej(i32 1)
; CHECK-NEXT:    [[TMP0:%.*]] = udiv i64 [[LINEARIZED_LID_GID1]], [[SIZE_LID_GID1]]
; CHECK-NEXT:    [[RECOVERED_LID_GID1:%.*]] = urem i64 [[TMP0]], [[CURRENT_DIM_SIZE_LID_GID1]]
; CHECK-NEXT:    [[LINEARIZED_GROUPID_GID1:%.*]] = call i64 @_Z12get_group_idj(i32 0)
; CHECK-NEXT:    [[SIZE_GROUPID_GID1:%.*]] = call i64 @user._Z14get_num_groupsj(i32 0)
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_GROUPID_GID1:%.*]] = call i64 @user._Z14get_num_groupsj(i32 1)
; CHECK-NEXT:    [[TMP1:%.*]] = udiv i64 [[LINEARIZED_GROUPID_GID1]], [[SIZE_GROUPID_GID1]]
; CHECK-NEXT:    [[RECOVERED_GROUPID_GID1:%.*]] = urem i64 [[TMP1]], [[CURRENT_DIM_SIZE_GROUPID_GID1]]
; CHECK-NEXT:    [[LSIZE_GID1:%.*]] = call i64 @user._Z14get_local_sizej(i32 1)
; CHECK-NEXT:    [[GROUPOFFSET_GID1:%.*]] = mul nuw i64 [[RECOVERED_GROUPID_GID1]], [[LSIZE_GID1]]
; CHECK-NEXT:    [[TRANSLATED_GID1:%.*]] = add nuw i64 [[RECOVERED_LID_GID1]], [[GROUPOFFSET_GID1]]
; CHECK-NEXT:    [[LINEARIZED_LID_GID2:%.*]] = call i64 @_Z12get_local_idj(i32 0)
; CHECK-NEXT:    [[SIZE_LID_GID2:%.*]] = call i64 @user._Z14get_local_sizej(i32 0)
; CHECK-NEXT:    [[SIZE_LID_GID21:%.*]] = call i64 @user._Z14get_local_sizej(i32 1)
; CHECK-NEXT:    [[LEADING_DIM_SIZE_LID_GID2:%.*]] = mul nuw i64 [[SIZE_LID_GID2]], [[SIZE_LID_GID21]]
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_LID_GID2:%.*]] = call i64 @user._Z14get_local_sizej(i32 2)
; CHECK-NEXT:    [[TMP2:%.*]] = udiv i64 [[LINEARIZED_LID_GID2]], [[LEADING_DIM_SIZE_LID_GID2]]
; CHECK-NEXT:    [[RECOVERED_LID_GID2:%.*]] = urem i64 [[TMP2]], [[CURRENT_DIM_SIZE_LID_GID2]]
; CHECK-NEXT:    [[LINEARIZED_GROUPID_GID2:%.*]] = call i64 @_Z12get_group_idj(i32 0)
; CHECK-NEXT:    [[SIZE_GROUPID_GID2:%.*]] = call i64 @user._Z14get_num_groupsj(i32 0)
; CHECK-NEXT:    [[SIZE_GROUPID_GID22:%.*]] = call i64 @user._Z14get_num_groupsj(i32 1)
; CHECK-NEXT:    [[LEADING_DIM_SIZE_GROUPID_GID2:%.*]] = mul nuw i64 [[SIZE_GROUPID_GID2]], [[SIZE_GROUPID_GID22]]
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_GROUPID_GID2:%.*]] = call i64 @user._Z14get_num_groupsj(i32 2)
; CHECK-NEXT:    [[TMP3:%.*]] = udiv i64 [[LINEARIZED_GROUPID_GID2]], [[LEADING_DIM_SIZE_GROUPID_GID2]]
; CHECK-NEXT:    [[RECOVERED_GROUPID_GID2:%.*]] = urem i64 [[TMP3]], [[CURRENT_DIM_SIZE_GROUPID_GID2]]
; CHECK-NEXT:    [[LSIZE_GID2:%.*]] = call i64 @user._Z14get_local_sizej(i32 2)
; CHECK-NEXT:    [[GROUPOFFSET_GID2:%.*]] = mul nuw i64 [[RECOVERED_GROUPID_GID2]], [[LSIZE_GID2]]
; CHECK-NEXT:    [[TRANSLATED_GID2:%.*]] = add nuw i64 [[RECOVERED_LID_GID2]], [[GROUPOFFSET_GID2]]
; CHECK-NEXT:    ret void
;
entry:
  %gid0 = call i64 @_Z13get_global_idj(i32 0)
  %gid1 = call i64 @_Z13get_global_idj(i32 1)
  %gid2 = call i64 @_Z13get_global_idj(i32 2)
  ret void
}

define void @lid() {
; CHECK-LABEL: @lid(
; CHECK-SAME: !sg_construction_mode ![[#MD]]
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[LINEARIZED_LID0:%.*]] = call i64 @_Z12get_local_idj(i32 0)
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_LID0:%.*]] = call i64 @user._Z14get_local_sizej(i32 0)
; CHECK-NEXT:    [[RECOVERED_LID0:%.*]] = urem i64 [[LINEARIZED_LID0]], [[CURRENT_DIM_SIZE_LID0]]
; CHECK-NEXT:    [[LINEARIZED_LID1:%.*]] = call i64 @_Z12get_local_idj(i32 0)
; CHECK-NEXT:    [[SIZE_LID1:%.*]] = call i64 @user._Z14get_local_sizej(i32 0)
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_LID1:%.*]] = call i64 @user._Z14get_local_sizej(i32 1)
; CHECK-NEXT:    [[TMP0:%.*]] = udiv i64 [[LINEARIZED_LID1]], [[SIZE_LID1]]
; CHECK-NEXT:    [[RECOVERED_LID1:%.*]] = urem i64 [[TMP0]], [[CURRENT_DIM_SIZE_LID1]]
; CHECK-NEXT:    [[LINEARIZED_LID2:%.*]] = call i64 @_Z12get_local_idj(i32 0)
; CHECK-NEXT:    [[SIZE_LID2:%.*]] = call i64 @user._Z14get_local_sizej(i32 0)
; CHECK-NEXT:    [[SIZE_LID21:%.*]] = call i64 @user._Z14get_local_sizej(i32 1)
; CHECK-NEXT:    [[LEADING_DIM_SIZE_LID2:%.*]] = mul nuw i64 [[SIZE_LID2]], [[SIZE_LID21]]
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_LID2:%.*]] = call i64 @user._Z14get_local_sizej(i32 2)
; CHECK-NEXT:    [[TMP1:%.*]] = udiv i64 [[LINEARIZED_LID2]], [[LEADING_DIM_SIZE_LID2]]
; CHECK-NEXT:    [[RECOVERED_LID2:%.*]] = urem i64 [[TMP1]], [[CURRENT_DIM_SIZE_LID2]]
; CHECK-NEXT:    ret void
;
entry:
  %lid0 = call i64 @_Z12get_local_idj(i32 0)
  %lid1 = call i64 @_Z12get_local_idj(i32 1)
  %lid2 = call i64 @_Z12get_local_idj(i32 2)
  ret void
}

define void @groupid() {
; CHECK-LABEL: @groupid(
; CHECK-SAME: !sg_construction_mode ![[#MD]]
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[LINEARIZED_GROUPID0:%.*]] = call i64 @_Z12get_group_idj(i32 0)
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_GROUPID0:%.*]] = call i64 @user._Z14get_num_groupsj(i32 0)
; CHECK-NEXT:    [[RECOVERED_GROUPID0:%.*]] = urem i64 [[LINEARIZED_GROUPID0]], [[CURRENT_DIM_SIZE_GROUPID0]]
; CHECK-NEXT:    [[LINEARIZED_GROUPID1:%.*]] = call i64 @_Z12get_group_idj(i32 0)
; CHECK-NEXT:    [[SIZE_GROUPID1:%.*]] = call i64 @user._Z14get_num_groupsj(i32 0)
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_GROUPID1:%.*]] = call i64 @user._Z14get_num_groupsj(i32 1)
; CHECK-NEXT:    [[TMP0:%.*]] = udiv i64 [[LINEARIZED_GROUPID1]], [[SIZE_GROUPID1]]
; CHECK-NEXT:    [[RECOVERED_GROUPID1:%.*]] = urem i64 [[TMP0]], [[CURRENT_DIM_SIZE_GROUPID1]]
; CHECK-NEXT:    [[LINEARIZED_GROUPID2:%.*]] = call i64 @_Z12get_group_idj(i32 0)
; CHECK-NEXT:    [[SIZE_GROUPID2:%.*]] = call i64 @user._Z14get_num_groupsj(i32 0)
; CHECK-NEXT:    [[SIZE_GROUPID21:%.*]] = call i64 @user._Z14get_num_groupsj(i32 1)
; CHECK-NEXT:    [[LEADING_DIM_SIZE_GROUPID2:%.*]] = mul nuw i64 [[SIZE_GROUPID2]], [[SIZE_GROUPID21]]
; CHECK-NEXT:    [[CURRENT_DIM_SIZE_GROUPID2:%.*]] = call i64 @user._Z14get_num_groupsj(i32 2)
; CHECK-NEXT:    [[TMP1:%.*]] = udiv i64 [[LINEARIZED_GROUPID2]], [[LEADING_DIM_SIZE_GROUPID2]]
; CHECK-NEXT:    [[RECOVERED_GROUPID2:%.*]] = urem i64 [[TMP1]], [[CURRENT_DIM_SIZE_GROUPID2]]
; CHECK-NEXT:    ret void
;
entry:
  %groupid0 = call i64 @_Z12get_group_idj(i32 0)
  %groupid1 = call i64 @_Z12get_group_idj(i32 1)
  %groupid2 = call i64 @_Z12get_group_idj(i32 2)
  ret void
}

declare i64 @_Z13get_global_idj(i32 %x)
declare i64 @_Z12get_local_idj(i32 %x)
declare i64 @_Z12get_group_idj(i32 %x)

!sycl.kernels = !{!0}

!0 = !{void ()* @gid, void ()* @lid, void ()* @groupid}

; CHECK: ![[#MD]] = !{i32 -1}

; DEBUGIFY-NOT: WARNING
