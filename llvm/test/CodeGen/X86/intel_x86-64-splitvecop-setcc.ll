; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=x86_64-unknown-unknown -mattr=+avx512vl,+avx512bw | FileCheck %s

; Function Attrs: noinline nounwind optnone uwtable
define <2 x i16> @foo(<2 x half>%a) #0 {
; CHECK-LABEL: foo:
; CHECK:       # %bb.0:
; CHECK-NEXT:    vpextrw $0, %xmm1, %eax
; CHECK-NEXT:    vpextrw $0, %xmm0, %ecx
; CHECK-NEXT:    movzwl %cx, %ecx
; CHECK-NEXT:    vmovd %ecx, %xmm0
; CHECK-NEXT:    vcvtph2ps %xmm0, %xmm0
; CHECK-NEXT:    vpxor %xmm1, %xmm1, %xmm1
; CHECK-NEXT:    vucomiss %xmm1, %xmm0
; CHECK-NEXT:    setnp %cl
; CHECK-NEXT:    sete %dl
; CHECK-NEXT:    andb %cl, %dl
; CHECK-NEXT:    andl $1, %edx
; CHECK-NEXT:    kmovw %edx, %k0
; CHECK-NEXT:    movzwl %ax, %eax
; CHECK-NEXT:    vmovd %eax, %xmm0
; CHECK-NEXT:    vcvtph2ps %xmm0, %xmm0
; CHECK-NEXT:    vucomiss {{\.?LCPI[0-9]+_[0-9]+}}(%rip), %xmm0
; CHECK-NEXT:    setnp %al
; CHECK-NEXT:    sete %cl
; CHECK-NEXT:    andb %al, %cl
; CHECK-NEXT:    kmovd %ecx, %k1
; CHECK-NEXT:    kshiftlw $1, %k1, %k1
; CHECK-NEXT:    korw %k1, %k0, %k0
; CHECK-NEXT:    vpmovm2w %k0, %xmm0
; CHECK-NEXT:    retq
  %1 = fcmp oeq <2 x half> %a,  <half 0xH0000, half 0xH3C00>
  %2 = sext <2 x i1> %1 to <2 x i16>
  ret <2 x i16>%2
}

