; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=x86_64-unknown-unknown -mattr=+sse -enable-intel-advanced-opts -intel-libirc-allowed -ftz | FileCheck %s --check-prefix=CHECK-NO-FTZ
; RUN: llc < %s -mtriple=x86_64-unknown-unknown -mattr=+sse -enable-intel-advanced-opts -intel-libirc-allowed | FileCheck %s --check-prefix=CHECK-NO-FTZ2
; RUN: llc < %s -mtriple=x86_64-unknown-unknown -mattr=+sse -ftz | FileCheck %s --check-prefix=CHECK-PINIT-FTZ

define dso_local i32 @main() {
; CHECK-NO-FTZ-LABEL: main:
; CHECK-NO-FTZ:       # %bb.0: # %entry
; CHECK-NO-FTZ-NEXT:    pushq %rax
; CHECK-NO-FTZ-NEXT:    .cfi_def_cfa_offset 16
; CHECK-NO-FTZ-NEXT:    movl $32, %esi
; CHECK-NO-FTZ-NEXT:    movl $17, %edi
; CHECK-NO-FTZ-NEXT:    callq __intel_new_feature_proc_init
; CHECK-NO-FTZ-NEXT:    movl $0, {{[0-9]+}}(%rsp)
; CHECK-NO-FTZ-NEXT:    xorl %eax, %eax
; CHECK-NO-FTZ-NEXT:    popq %rcx
; CHECK-NO-FTZ-NEXT:    .cfi_def_cfa_offset 8
; CHECK-NO-FTZ-NEXT:    retq
;
; CHECK-NO-FTZ2-LABEL: main:
; CHECK-NO-FTZ2:       # %bb.0: # %entry
; CHECK-NO-FTZ2-NEXT:    pushq %rax
; CHECK-NO-FTZ2-NEXT:    .cfi_def_cfa_offset 16
; CHECK-NO-FTZ2-NEXT:    movl $32, %esi
; CHECK-NO-FTZ2-NEXT:    xorl %edi, %edi
; CHECK-NO-FTZ2-NEXT:    callq __intel_new_feature_proc_init
; CHECK-NO-FTZ2-NEXT:    movl $0, {{[0-9]+}}(%rsp)
; CHECK-NO-FTZ2-NEXT:    xorl %eax, %eax
; CHECK-NO-FTZ2-NEXT:    popq %rcx
; CHECK-NO-FTZ2-NEXT:    .cfi_def_cfa_offset 8
; CHECK-NO-FTZ2-NEXT:    retq
;
; CHECK-PINIT-FTZ-LABEL: main:
; CHECK-PINIT-FTZ:       # %bb.0: # %entry
; CHECK-PINIT-FTZ-NEXT:    stmxcsr -{{[0-9]+}}(%rsp)
; CHECK-PINIT-FTZ-NEXT:    orl $32832, -{{[0-9]+}}(%rsp) # imm = 0x8040
; CHECK-PINIT-FTZ-NEXT:    ldmxcsr -{{[0-9]+}}(%rsp)
; CHECK-PINIT-FTZ-NEXT:    movl $0, -{{[0-9]+}}(%rsp)
; CHECK-PINIT-FTZ-NEXT:    xorl %eax, %eax
; CHECK-PINIT-FTZ-NEXT:    retq
entry:
  %retval = alloca i32, align 4
  store i32 0, i32* %retval, align 4
  ret i32 0
}
