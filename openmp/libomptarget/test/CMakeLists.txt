# CMakeLists.txt file for unit testing OpenMP offloading runtime library.
if(NOT OPENMP_TEST_COMPILER_ID STREQUAL "Clang" OR
   OPENMP_TEST_COMPILER_VERSION VERSION_LESS 6.0.0)
  libomptarget_say("Can only test with Clang compiler in version 6.0.0 or later.")
  libomptarget_warning_say("The check-libomptarget target will not be available!")
  return()
endif()

if(LIBOMPTARGET_ENABLE_DEBUG)
  set(LIBOMPTARGET_DEBUG True)
else()
  set(LIBOMPTARGET_DEBUG False)
endif()

# INTEL_CUSTOMIZATION
# Do not add omp as a dependency since Intel specific OpenMP runtime is being
# used.
  add_openmp_testsuite(check-libomptarget "Running libomptarget tests" ${CMAKE_CURRENT_BINARY_DIR} DEPENDS omptarget ${LIBOMPTARGET_TESTED_PLUGINS})
# end INTEL_CUSTOMIZATION

if (INTEL_CUSTOMIZATION)
  configure_lit_site_cfg(
    "${CMAKE_CURRENT_SOURCE_DIR}/lit.site.cfg.in"
    "${CMAKE_CURRENT_BINARY_DIR}/lit.site.cfg"
    MAIN_CONFIG
    ${CMAKE_CURRENT_SOURCE_DIR}/lit.cfg
    )
else(INTEL_CUSTOMIZATION)
# Configure the lit.site.cfg.in file
set(AUTO_GEN_COMMENT "## Autogenerated by libomptarget configuration.\n# Do not edit!")
configure_file(lit.site.cfg.in lit.site.cfg @ONLY)
endif(INTEL_CUSTOMIZATION)
